(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"5azF":function(e,t,i){"use strict";i.r(t),i.d(t,"PoolModule",function(){return ta}),i.d(t,"RoutedPoolModule",function(){return aa});var a=i("SVse"),o=i("s7LF"),c=i("iInd"),s=i("G0yt"),n=i("sne2"),l=i("PCNd"),r=i("k/xb"),b=i("kJI8"),u=i("LvDl"),d=i.n(u),f=i("jtHE"),m=i("WE5d"),h=i("st4c"),p=i("8Y7J"),g=i("IheW");let v=(()=>{class e{constructor(e){this.http=e,this.apiPath="api/erasure_code_profile",this.formTooltips={k:"Each object is split in data-chunks parts, each stored on a different OSD.",m:"Compute coding chunks for each object and store them on different OSDs.\n      The number of coding chunks is also the number of OSDs that can be down without losing data.",plugins:{jerasure:{description:"The jerasure plugin is the most generic and flexible plugin,\n          it is also the default for Ceph erasure coded pools.",technique:"The more flexible technique is reed_sol_van : it is enough to set k\n          and m. The cauchy_good technique can be faster but you need to chose the packetsize\n          carefully. All of reed_sol_r6_op, liberation, blaum_roth, liber8tion are RAID6 equivalents\n          in the sense that they can only be configured with m=2.",packetSize:"The encoding will be done on packets of bytes size at a time.\n          Choosing the right packet size is difficult.\n          The jerasure documentation contains extensive information on this topic."},lrc:{description:"With the jerasure plugin, when an erasure coded object is stored on\n          multiple OSDs, recovering from the loss of one OSD requires reading from all the others.\n          For instance if jerasure is configured with k=8 and m=4, losing one OSD requires reading\n          from the eleven others to repair.\n\n          The lrc erasure code plugin creates local parity chunks to be able to recover using\n          less OSDs. For instance if lrc is configured with k=8, m=4 and l=4, it will create\n          an additional parity chunk for every four OSDs. When a single OSD is lost, it can be\n          recovered with only four OSDs instead of eleven.",l:"Group the coding and data chunks into sets of size locality. For instance,\n          for k=4 and m=2, when locality=3 two groups of three are created. Each set can\n          be recovered without reading chunks from another set.",crushLocality:"The type of the crush bucket in which each set of chunks defined\n          by l will be stored. For instance, if it is set to rack, each group of l chunks will be\n          placed in a different rack. It is used to create a CRUSH rule step such as step choose\n          rack. If it is not set, no such grouping is done."},isa:{description:"The isa plugin encapsulates the ISA library. It only runs on Intel processors.",technique:"The ISA plugin comes in two Reed Solomon forms.\n          If reed_sol_van is set, it is Vandermonde, if cauchy is set, it is Cauchy."},shec:{description:"The shec plugin encapsulates the multiple SHEC library.\n          It allows ceph to recover data more efficiently than Reed Solomon codes.",c:"The number of parity chunks each of which includes each data chunk in its\n          calculation range. The number is used as a durability estimator. For instance, if c=2,\n          2 OSDs can be down without losing data."},clay:{description:"CLAY (short for coupled-layer) codes are erasure codes designed to\n          bring about significant savings in terms of network bandwidth and disk IO when a failed\n          node/OSD/rack is being repaired.",d:"Number of OSDs requested to send data during recovery of a single chunk.\n          d needs to be chosen such that k+1 <= d <= k+m-1. The larger the d, the better\n          the savings.",scalar_mds:"scalar_mds specifies the plugin that is used as a building block\n          in the layered construction. It can be one of jerasure, isa, shec.",technique:"technique specifies the technique that will be picked\n          within the 'scalar_mds' plugin specified. Supported techniques\n          are 'reed_sol_van', 'reed_sol_r6_op', 'cauchy_orig',\n          'cauchy_good', 'liber8tion' for jerasure, 'reed_sol_van',\n          'cauchy' for isa and 'single', 'multiple' for shec."}},crushRoot:"The name of the crush bucket used for the first step of the CRUSH rule.\n      For instance step take default.",crushFailureDomain:"Ensure that no two chunks are in a bucket with the same failure\n      domain. For instance, if the failure domain is host no two chunks will be stored on the same\n      host. It is used to create a CRUSH rule step such as step chooseleaf host.",crushDeviceClass:"Restrict placement to devices of a specific class\n      (e.g., ssd or hdd), using the crush device class names in the CRUSH map.",directory:"Set the directory name from which the erasure code plugin is loaded."}}list(){return this.http.get(this.apiPath)}create(e){return this.http.post(this.apiPath,e,{observe:"response"})}delete(e){return this.http.delete(`${this.apiPath}/${e}`,{observe:"response"})}getInfo(){return this.http.get(`ui-${this.apiPath}/info`)}}return e.\u0275fac=function(t){return new(t||e)(p.ic(g.b))},e.\u0275prov=p.Nb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=i("Ekvf");class W{constructor(){this.nodes=[],this.idTree={},this.allDevices=[],this.buckets=[],this.failureDomains={},this.failureDomainKeys=[],this.devices=[],this.deviceCount=0}static searchFailureDomains(e,t){return this.getFailureDomains(this.search(e,t))}static search(e,t){const[i,a]=t.split("~"),o=e.find(e=>["name","id","type"].some(t=>e[t]===i));return o?(e=this.getSubNodes(o,this.createIdTreeFromNodes(e)),a&&(e=this.filterNodesByDeviceType(e,a)),e):[]}static createIdTreeFromNodes(e){const t={};return e.forEach(e=>{t[e.id]=e}),t}static getSubNodes(e,t){let i=[e];return e.children?(e.children.forEach(e=>{i=i.concat(this.getSubNodes(t[e],t))}),i):i}static filterNodesByDeviceType(e,t){let i,a=e.filter(e=>e.device_class&&e.device_class!==t).map(e=>e.id),o=a;do{i=!1,e=e.filter(e=>!a.includes(e.id));const t=[];e.forEach(e=>{e.children&&e.children.every(e=>a.includes(e))&&(t.push(e.id),i=!0)}),i&&(a=t,o=o.concat(t))}while(i);return(e=d.a.cloneDeep(e)).map(e=>e.children?(e.children=e.children.filter(e=>!o.includes(e)),e):e)}static getFailureDomains(e){const t={};return e.forEach(e=>{const i=e.type;t[i]||(t[i]=[]),t[i].push(e)}),t}initCrushNodeSelection(e,t,i,a){this.nodes=e,this.idTree=W.createIdTreeFromNodes(e),e.forEach(e=>{this.idTree[e.id]=e}),this.buckets=d.a.sortBy(e.filter(e=>e.children),"name"),this.controls={root:t,failure:i,device:a},this.preSelectRoot(),this.controls.root.valueChanges.subscribe(()=>this.onRootChange()),this.controls.failure.valueChanges.subscribe(()=>this.onFailureDomainChange()),this.controls.device.valueChanges.subscribe(()=>this.onDeviceChange())}preSelectRoot(){const e=this.nodes.find(e=>"root"===e.type);this.silentSet(this.controls.root,e),this.onRootChange()}silentSet(e,t){e.setValue(t,{emitEvent:!1})}onRootChange(){const e=W.getSubNodes(this.controls.root.value,this.idTree),t=W.getFailureDomains(e);Object.keys(t).forEach(e=>{t[e].length<=1&&delete t[e]}),this.failureDomains=t,this.failureDomainKeys=Object.keys(t).sort(),this.updateFailureDomain()}updateFailureDomain(){let e=this.getIncludedCustomValue(this.controls.failure,Object.keys(this.failureDomains));""===e&&(e=this.setMostCommonDomain(this.controls.failure)),this.updateDevices(e)}getIncludedCustomValue(e,t){return e.dirty&&t.includes(e.value)?e.value:""}setMostCommonDomain(e){let t={n:0,type:""};return Object.keys(this.failureDomains).forEach(e=>{const i=this.failureDomains[e].length;t.n<i&&(t={n:i,type:e})}),this.silentSet(e,t.type),t.type}onFailureDomainChange(){this.updateDevices()}updateDevices(e=this.controls.failure.value){const t=d.a.flatten(this.failureDomains[e].map(e=>W.getSubNodes(e,this.idTree)));this.allDevices=t.filter(e=>e.device_class).map(e=>e.device_class),this.devices=d.a.uniq(this.allDevices).sort();const i=1===this.devices.length?this.devices[0]:this.getIncludedCustomValue(this.controls.device,this.devices);this.silentSet(this.controls.device,i),this.onDeviceChange(i)}onDeviceChange(e=this.controls.device.value){this.deviceCount=""===e?this.allDevices.length:this.allDevices.filter(t=>t===e).length}}var I=i("0+/T"),z=i("a96k"),P=i("oxzT"),C=i("spCT"),X=i("QFaf"),S=i("1Ni5"),y=i("PhyI"),_=i("kvvV"),N=i("Fgil"),$=i("aexS"),T=i("aXbf"),w=i("JK/P"),E=i("kn/O"),R=i("2EZI"),k=i("ajRT"),x=i("NwgZ"),A=i("ocLN"),V=i("ANnk"),F=i("f69J"),O=i("IZUe"),L=i("p4Cf"),q=i("6+kj"),M=i("8xTl");function B(e,t){1&e&&(p.Xb(0,"span",30),p.bc(1,31),p.Wb())}function U(e,t){1&e&&(p.Xb(0,"span",30),p.bc(1,32),p.Wb())}function G(e,t){1&e&&(p.Xb(0,"span",30),p.bc(1,33),p.Wb())}function j(e,t){1&e&&(p.Xb(0,"option",26),p.bc(1,34),p.Wb())}function J(e,t){if(1&e&&(p.Xb(0,"option",35),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e.name," ")}}function K(e,t){1&e&&(p.Xb(0,"span",30),p.bc(1,36),p.Wb())}function Y(e,t){1&e&&(p.Xb(0,"option",26),p.bc(1,37),p.Wb())}function H(e,t){if(1&e&&(p.Xb(0,"option",35),p.Rc(1),p.Wb()),2&e){const e=t.$implicit,i=p.nc();p.uc("ngValue",e),p.Db(1),p.Uc(" ",e," ( ",i.failureDomains[e].length," ) ")}}function Q(e,t){1&e&&(p.Xb(0,"span",30),p.bc(1,38),p.Wb())}function Z(e,t){if(1&e&&(p.Xb(0,"option",35),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e," ")}}let ee=(()=>{class e extends W{constructor(e,t,i,a,o){super(),this.formBuilder=e,this.activeModal=t,this.taskWrapper=i,this.crushRuleService=a,this.actionLabels=o,this.submitAction=new p.p,this.tooltips=this.crushRuleService.formTooltips,this.action=this.actionLabels.CREATE,this.resource="Crush Rule",this.createForm()}createForm(){this.form=this.formBuilder.group({name:["",[o.A.required,o.A.pattern("[A-Za-z0-9_-]+"),S.a.custom("uniqueName",e=>this.names&&-1!==this.names.indexOf(e))]],root:null,failure_domain:"",device_class:""})}ngOnInit(){this.crushRuleService.getInfo().subscribe(({names:e,nodes:t})=>{this.initCrushNodeSelection(t,this.form.get("root"),this.form.get("failure_domain"),this.form.get("device_class")),this.names=e})}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const e=d.a.cloneDeep(this.form.value);e.root=e.root.name,""===e.device_class&&delete e.device_class,this.taskWrapper.wrapTaskAroundCall({task:new _.a("crushRule/create",e),call:this.crushRuleService.create(e)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(e)}})}}return e.\u0275fac=function(t){return new(t||e)(p.Rb(R.a),p.Rb(s.a),p.Rb(E.a),p.Rb(h.a),p.Rb(n.b))},e.\u0275cmp=p.Lb({type:e,selectors:[["cd-crush-rule-form-modal"]],outputs:{submitAction:"submitAction"},features:[p.Ab],decls:55,vars:27,consts:function(){let e,t,i,a,o,c,s,n,l,r,b,u,d;return e="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Name",i="Root",a="Failure domain type",o="Device class",c="Let Ceph decide",s="This field is required!",n="The name can only consist of alphanumeric characters, dashes and underscores.",l="The chosen erasure code profile name is already in use.",r="Loading...",b="This field is required!",u="Loading...",d="This field is required!",[[3,"modalRef"],[1,"modal-title"],e,[1,"modal-content"],["novalidate","",3,"formGroup"],["frm","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],t,[1,"required"],[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","root",1,"cd-col-form-label"],i,[3,"html"],["id","root","name","root","formControlName","root",1,"form-control","custom-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","failure_domain",1,"cd-col-form-label"],a,["id","failure_domain","name","failure_domain","formControlName","failure_domain",1,"form-control","custom-select"],["for","device_class",1,"cd-col-form-label"],o,["id","device_class","name","device_class","formControlName","device_class",1,"form-control","custom-select"],["ngValue",""],c,[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],s,n,l,r,[3,"ngValue"],b,u,d]},template:function(e,t){if(1&e&&(p.Xb(0,"cd-modal",0),p.Vb(1,1),p.bc(2,2),p.oc(3,"titlecase"),p.oc(4,"upperFirst"),p.Ub(),p.Vb(5,3),p.Xb(6,"form",4,5),p.Xb(8,"div",6),p.Xb(9,"div",7),p.Xb(10,"label",8),p.Vb(11),p.bc(12,9),p.Ub(),p.Sb(13,"span",10),p.Wb(),p.Xb(14,"div",11),p.Sb(15,"input",12),p.Pc(16,B,2,0,"span",13),p.Pc(17,U,2,0,"span",13),p.Pc(18,G,2,0,"span",13),p.Wb(),p.Wb(),p.Xb(19,"div",7),p.Xb(20,"label",14),p.Vb(21),p.bc(22,15),p.Ub(),p.Sb(23,"cd-helper",16),p.Sb(24,"span",10),p.Wb(),p.Xb(25,"div",11),p.Xb(26,"select",17),p.Pc(27,j,2,0,"option",18),p.Pc(28,J,2,2,"option",19),p.Wb(),p.Pc(29,K,2,0,"span",13),p.Wb(),p.Wb(),p.Xb(30,"div",7),p.Xb(31,"label",20),p.Vb(32),p.bc(33,21),p.Ub(),p.Sb(34,"cd-helper",16),p.Sb(35,"span",10),p.Wb(),p.Xb(36,"div",11),p.Xb(37,"select",22),p.Pc(38,Y,2,0,"option",18),p.Pc(39,H,2,3,"option",19),p.Wb(),p.Pc(40,Q,2,0,"span",13),p.Wb(),p.Wb(),p.Xb(41,"div",7),p.Xb(42,"label",23),p.Vb(43),p.bc(44,24),p.Ub(),p.Sb(45,"cd-helper",16),p.Wb(),p.Xb(46,"div",11),p.Xb(47,"select",25),p.Xb(48,"option",26),p.bc(49,27),p.Wb(),p.Pc(50,Z,2,2,"option",19),p.Wb(),p.Wb(),p.Wb(),p.Wb(),p.Xb(51,"div",28),p.Xb(52,"cd-form-button-panel",29),p.lc("submitActionEvent",function(){return t.onSubmit()}),p.oc(53,"titlecase"),p.oc(54,"upperFirst"),p.Wb(),p.Wb(),p.Wb(),p.Ub(),p.Wb()),2&e){const e=p.Fc(7);p.uc("modalRef",t.activeModal),p.Db(4),p.fc(p.pc(3,19,t.action))(p.pc(4,21,t.resource)),p.cc(2),p.Db(2),p.uc("formGroup",t.form),p.Db(10),p.uc("ngIf",t.form.showError("name",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"pattern")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"uniqueName")),p.Db(5),p.uc("html",t.tooltips.root),p.Db(4),p.uc("ngIf",!t.buckets),p.Db(1),p.uc("ngForOf",t.buckets),p.Db(1),p.uc("ngIf",t.form.showError("root",e,"required")),p.Db(5),p.uc("html",t.tooltips.failure_domain),p.Db(4),p.uc("ngIf",!t.failureDomains),p.Db(1),p.uc("ngForOf",t.failureDomainKeys),p.Db(1),p.uc("ngIf",t.form.showError("failure_domain",e,"required")),p.Db(5),p.uc("html",t.tooltips.device_class),p.Db(5),p.uc("ngForOf",t.devices),p.Db(2),p.uc("form",t.form)("submitText",p.pc(53,23,t.action)+" "+p.pc(54,25,t.resource))}},directives:[k.a,o.B,o.r,x.a,o.k,A.a,V.a,o.d,F.a,o.q,o.i,O.a,a.r,L.a,o.z,a.q,o.u,o.C,q.a],pipes:[a.A,M.a],styles:[""]}),e})();class te{}function ie(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,47),p.Wb())}function ae(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,48),p.Wb())}function oe(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,49),p.Wb())}function ce(e,t){1&e&&(p.Xb(0,"option",37),p.bc(1,50),p.Wb())}function se(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e," ")}}function ne(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,52),p.Wb())}function le(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,53),p.Wb())}function re(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,54),p.Wb())}function be(e,t){if(1&e&&(p.Xb(0,"span",46),p.bc(1,55),p.Wb()),2&e){const e=p.nc();p.Db(1),p.fc(e.deviceCount),p.cc(1)}}function ue(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,56),p.Wb())}function de(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,57),p.Wb())}function fe(e,t){if(1&e&&(p.Xb(0,"span",39),p.bc(1,58),p.Wb()),2&e){const e=p.nc();p.Db(1),p.fc(e.lrcMultiK),p.cc(1)}}function me(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,59),p.Wb())}function he(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,60),p.Wb())}function pe(e,t){if(1&e&&(p.Xb(0,"span",46),p.bc(1,61),p.Wb()),2&e){const e=p.nc();p.Db(1),p.fc(e.deviceCount),p.cc(1)}}function ge(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,65),p.Wb())}function ve(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,66),p.Wb())}function De(e,t){if(1&e&&(p.Xb(0,"div",7),p.Xb(1,"label",62),p.Xb(2,"span",14),p.bc(3,63),p.Wb(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Sb(6,"input",64),p.Pc(7,ge,2,0,"span",12),p.Pc(8,ve,2,0,"span",12),p.Wb(),p.Wb()),2&e){const e=p.nc(),t=p.Fc(7);p.Db(4),p.uc("html",e.tooltips.plugins.shec.c),p.Db(3),p.uc("ngIf",e.form.showError("c",t,"min")),p.Db(1),p.uc("ngIf",e.form.showError("c",t,"cGreaterM"))}}function We(e,t){1&e&&(p.Xb(0,"span",39),p.bc(1,75),p.Wb())}function Ie(e,t){if(1&e&&(p.Xb(0,"span",39),p.bc(1,76),p.Wb()),2&e){const e=p.nc(3);p.Db(1),p.fc(e.getDMin())(e.getDMax()),p.cc(1)}}function ze(e,t){if(1&e&&(p.Xb(0,"span",39),p.bc(1,77),p.Wb()),2&e){const e=p.nc(3);p.Db(1),p.fc(e.getDMax()),p.cc(1)}}function Pe(e,t){if(1&e&&(p.Vb(0),p.Pc(1,Ie,2,2,"span",23),p.Pc(2,ze,2,1,"span",23),p.Ub()),2&e){const e=p.nc(2);p.Db(1),p.uc("ngIf",e.getDMin()<e.getDMax()),p.Db(1),p.uc("ngIf",e.getDMin()===e.getDMax())}}function Ce(e,t){if(1&e&&(p.Xb(0,"span",46),p.bc(1,78),p.Wb()),2&e){const e=p.nc(2);p.Db(1),p.fc(e.getDMin()),p.cc(1)}}function Xe(e,t){if(1&e&&(p.Xb(0,"span",46),p.bc(1,79),p.Wb()),2&e){const e=p.nc(2);p.Db(1),p.fc(e.getDMax()),p.cc(1)}}function Se(e,t){if(1&e){const e=p.Yb();p.Xb(0,"div",7),p.Xb(1,"label",67),p.Xb(2,"span",14),p.bc(3,68),p.Wb(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Xb(6,"div",69),p.Sb(7,"input",70),p.Xb(8,"span",71),p.Xb(9,"button",72),p.lc("click",function(){return p.Ic(e),p.nc().toggleDCalc()}),p.Sb(10,"i",73),p.Wb(),p.Wb(),p.Wb(),p.Pc(11,We,2,0,"span",23),p.Pc(12,Pe,3,2,"ng-container",74),p.Pc(13,Ce,2,1,"span",12),p.Pc(14,Xe,2,1,"span",12),p.Wb(),p.Wb()}if(2&e){const e=p.nc(),t=p.Fc(7);p.Db(4),p.uc("html",e.tooltips.plugins.clay.d),p.Db(6),p.uc("ngClass",e.dCalc?e.icons.unlock:e.icons.lock),p.Db(1),p.uc("ngIf",e.dCalc),p.Db(1),p.uc("ngIf",!e.dCalc),p.Db(1),p.uc("ngIf",e.form.showError("d",t,"dMin")),p.Db(1),p.uc("ngIf",e.form.showError("d",t,"dMax"))}}function ye(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,84),p.Wb())}function _e(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,85),p.Wb())}function Ne(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,86),p.Wb())}function $e(e,t){if(1&e&&(p.Xb(0,"div",7),p.Xb(1,"label",80),p.Xb(2,"span",14),p.bc(3,81),p.Wb(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Sb(6,"input",82),p.Pc(7,ye,2,0,"span",12),p.Pc(8,_e,2,0,"span",12),p.Pc(9,Ne,2,0,"span",12),p.Xb(10,"span",39),p.bc(11,83),p.Wb(),p.Wb(),p.Wb()),2&e){const e=p.nc(),t=p.Fc(7);p.Db(4),p.uc("html",e.tooltips.plugins.lrc.l),p.Db(3),p.uc("ngIf",e.form.showError("l",t,"required")),p.Db(1),p.uc("ngIf",e.form.showError("l",t,"min")),p.Db(1),p.uc("ngIf",e.form.showError("l",t,"unequal")),p.Db(2),p.fc(e.lrcGroups),p.cc(11)}}function Te(e,t){1&e&&(p.Xb(0,"option",37),p.bc(1,87),p.Wb())}function we(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit,i=p.nc();p.uc("ngValue",e),p.Db(1),p.Uc(" ",e," ( ",i.failureDomains[e].length," ) ")}}function Ee(e,t){1&e&&(p.Xb(0,"option",37),p.bc(1,91),p.Wb())}function Re(e,t){1&e&&(p.Xb(0,"option",37),p.bc(1,92),p.Wb())}function ke(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit,i=p.nc(2);p.uc("ngValue",e),p.Db(1),p.Uc(" ",e," ( ",i.failureDomains[e].length," ) ")}}function xe(e,t){if(1&e&&(p.Xb(0,"div",7),p.Xb(1,"label",88),p.Vb(2),p.bc(3,89),p.Ub(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Xb(6,"select",90),p.Pc(7,Ee,2,0,"option",18),p.Pc(8,Re,2,0,"option",18),p.Pc(9,ke,2,3,"option",19),p.Wb(),p.Wb(),p.Wb()),2&e){const e=p.nc();p.Db(4),p.uc("html",e.tooltips.plugins.lrc.crushLocality),p.Db(3),p.uc("ngIf",!e.failureDomains),p.Db(1),p.uc("ngIf",e.failureDomainKeys.length>0),p.Db(1),p.uc("ngForOf",e.failureDomainKeys)}}function Ae(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e," ")}}const Ve=function(e,t,i){return[e,t,i]};function Fe(e,t){if(1&e&&(p.Xb(0,"div",7),p.Xb(1,"label",93),p.Vb(2),p.bc(3,94),p.Ub(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Xb(6,"select",95),p.Pc(7,Ae,2,2,"option",19),p.Wb(),p.Wb(),p.Wb()),2&e){const e=p.nc();p.Db(4),p.uc("html",e.tooltips.plugins.clay.scalar_mds),p.Db(3),p.uc("ngForOf",p.Bc(2,Ve,e.PLUGIN.JERASURE,e.PLUGIN.ISA,e.PLUGIN.SHEC))}}function Oe(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e," ")}}function Le(e,t){if(1&e&&(p.Xb(0,"div",7),p.Xb(1,"label",96),p.Vb(2),p.bc(3,97),p.Ub(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Xb(6,"select",98),p.Pc(7,Oe,2,2,"option",19),p.Wb(),p.Wb(),p.Wb()),2&e){const e=p.nc();p.Db(4),p.uc("html",e.tooltips.plugins[e.plugin].technique),p.Db(3),p.uc("ngForOf",e.techniques)}}function qe(e,t){1&e&&(p.Xb(0,"span",46),p.bc(1,102),p.Wb())}function Me(e,t){if(1&e&&(p.Xb(0,"div",7),p.Xb(1,"label",99),p.Vb(2),p.bc(3,100),p.Ub(),p.Sb(4,"cd-helper",16),p.Wb(),p.Xb(5,"div",10),p.Sb(6,"input",101),p.Pc(7,qe,2,0,"span",12),p.Wb(),p.Wb()),2&e){const e=p.nc(),t=p.Fc(7);p.Db(4),p.uc("html",e.tooltips.plugins.jerasure.packetSize),p.Db(3),p.uc("ngIf",e.form.showError("packetSize",t,"min"))}}function Be(e,t){1&e&&(p.Xb(0,"option",37),p.bc(1,103),p.Wb())}function Ue(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e.name," ")}}function Ge(e,t){if(1&e&&(p.Xb(0,"option",51),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e," ")}}let je=(()=>{class e extends W{constructor(e,t,i,a,o){super(),this.formBuilder=e,this.activeModal=t,this.taskWrapper=i,this.ecpService=a,this.actionLabels=o,this.submitAction=new p.p,this.tooltips=this.ecpService.formTooltips,this.PLUGIN={LRC:"lrc",SHEC:"shec",CLAY:"clay",JERASURE:"jerasure",ISA:"isa"},this.plugin=this.PLUGIN.JERASURE,this.icons=P.a,this.action=this.actionLabels.CREATE,this.resource="EC Profile",this.createForm(),this.setJerasureDefaults()}createForm(){this.form=this.formBuilder.group({name:[null,[o.A.required,o.A.pattern("[A-Za-z0-9_-]+"),S.a.custom("uniqueName",e=>this.names&&-1!==this.names.indexOf(e))]],plugin:[this.PLUGIN.JERASURE,[o.A.required]],k:[4,[o.A.required,o.A.min(2),S.a.custom("max",()=>this.baseValueValidation(!0)),S.a.custom("unequal",e=>this.lrcDataValidation(e)),S.a.custom("kLowerM",e=>this.shecDataValidation(e))]],m:[2,[o.A.required,o.A.min(1),S.a.custom("max",()=>this.baseValueValidation())]],crushFailureDomain:"",crushRoot:null,crushDeviceClass:"",directory:"",technique:"reed_sol_van",packetSize:[2048,[o.A.min(1)]],l:[3,[o.A.required,o.A.min(1),S.a.custom("unequal",e=>this.lrcLocalityValidation(e))]],crushLocality:"",c:[2,[o.A.required,o.A.min(1),S.a.custom("cGreaterM",e=>this.shecDurabilityValidation(e))]],d:[5,[o.A.required,S.a.custom("dMin",e=>this.dMinValidation(e)),S.a.custom("dMax",e=>this.dMaxValidation(e))]],scalar_mds:[this.PLUGIN.JERASURE,[o.A.required]]}),this.toggleDCalc(),this.form.get("k").valueChanges.subscribe(()=>this.updateValidityOnChange(["m","l","d"])),this.form.get("m").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","l","c","d"])),this.form.get("l").valueChanges.subscribe(()=>this.updateValidityOnChange(["k","m"])),this.form.get("plugin").valueChanges.subscribe(e=>this.onPluginChange(e)),this.form.get("scalar_mds").valueChanges.subscribe(()=>this.setClayDefaultsForScalar())}baseValueValidation(e=!1){return this.validValidation(()=>this.getKMSum()>this.deviceCount&&this.form.getValue("k")>this.form.getValue("m")===e)}validValidation(e,t){return!((!this.form||t)&&this.plugin!==t)&&e()}getKMSum(){return this.form.getValue("k")+this.form.getValue("m")}lrcDataValidation(e){return this.validValidation(()=>{const t=this.form.getValue("m"),i=this.form.getValue("l"),a=e+t;return this.lrcMultiK=e/(a/i),e%(a/i)!=0},"lrc")}shecDataValidation(e){return this.validValidation(()=>this.form.getValue("m")>e,"shec")}lrcLocalityValidation(e){return this.validValidation(()=>{const t=this.getKMSum();return this.lrcGroups=e>0?t/e:0,e>0&&t%e!=0},"lrc")}shecDurabilityValidation(e){return this.validValidation(()=>{const t=this.form.getValue("m");return e>t},"shec")}dMinValidation(e){return this.validValidation(()=>this.getDMin()>e,"clay")}getDMin(){return this.form.getValue("k")+1}dMaxValidation(e){return this.validValidation(()=>e>this.getDMax(),"clay")}getDMax(){const e=this.form.getValue("m");return this.form.getValue("k")+e-1}toggleDCalc(){this.dCalc=!this.dCalc,this.form.get("d")[this.dCalc?"disable":"enable"](),this.calculateD()}calculateD(){this.plugin===this.PLUGIN.CLAY&&this.dCalc&&this.form.silentSet("d",this.getDMax())}updateValidityOnChange(e){e.forEach(e=>{"d"===e&&this.calculateD(),this.form.get(e).updateValueAndValidity({emitEvent:!1})})}onPluginChange(e){this.plugin=e,e===this.PLUGIN.JERASURE?this.setJerasureDefaults():e===this.PLUGIN.LRC?this.setLrcDefaults():e===this.PLUGIN.ISA?this.setIsaDefaults():e===this.PLUGIN.SHEC?this.setShecDefaults():e===this.PLUGIN.CLAY&&this.setClayDefaults(),this.updateValidityOnChange(["m"])}setJerasureDefaults(){this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liberation","blaum_roth","liber8tion"],this.setDefaults({k:4,m:2,technique:"reed_sol_van"})}setLrcDefaults(){this.setDefaults({k:4,m:2,l:3})}setIsaDefaults(){this.techniques=["reed_sol_van","cauchy"],this.setDefaults({k:7,m:3,technique:"reed_sol_van"})}setShecDefaults(){this.setDefaults({k:4,m:3,c:2})}setClayDefaults(){this.setDefaults({k:4,m:2,scalar_mds:this.PLUGIN.JERASURE}),this.setClayDefaultsForScalar()}setClayDefaultsForScalar(){const e=this.form.getValue("scalar_mds");let t="reed_sol_van";e===this.PLUGIN.JERASURE?this.techniques=["reed_sol_van","reed_sol_r6_op","cauchy_orig","cauchy_good","liber8tion"]:e===this.PLUGIN.ISA?this.techniques=["reed_sol_van","cauchy"]:(t="single",this.techniques=["single","multiple"]),this.setDefaults({technique:t})}setDefaults(e){Object.keys(e).forEach(t=>{const i=this.form.get(t),a=i.value;i.pristine||"technique"===t&&!this.techniques.includes(a)||"k"===t&&[4,7].includes(a)||"m"===t&&[2,3].includes(a)?i.setValue(e[t]):i.updateValueAndValidity()})}ngOnInit(){this.ecpService.getInfo().subscribe(({plugins:e,names:t,directory:i,nodes:a})=>{this.initCrushNodeSelection(a,this.form.get("crushRoot"),this.form.get("crushFailureDomain"),this.form.get("crushDeviceClass")),this.plugins=e,this.names=t,this.form.silentSet("directory",i),this.preValidateNumericInputFields()})}preValidateNumericInputFields(){const e=["k","m","l","c","d"].map(e=>this.form.get(e));e.forEach(e=>{e.markAsTouched(),e.markAsDirty()}),e[1].updateValueAndValidity()}onSubmit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const e=this.createJson();this.taskWrapper.wrapTaskAroundCall({task:new _.a("ecp/create",{name:e.name}),call:this.ecpService.create(e)}).subscribe({error:()=>{this.form.setErrors({cdSubmitButton:!0})},complete:()=>{this.activeModal.close(),this.submitAction.emit(e)}})}createJson(){const e={technique:[this.PLUGIN.ISA,this.PLUGIN.JERASURE,this.PLUGIN.CLAY],packetSize:[this.PLUGIN.JERASURE],l:[this.PLUGIN.LRC],crushLocality:[this.PLUGIN.LRC],c:[this.PLUGIN.SHEC],d:[this.PLUGIN.CLAY],scalar_mds:[this.PLUGIN.CLAY]},t=new te,i=this.form.getValue("plugin");return Object.keys(this.form.controls).filter(t=>{const a=e[t],o=this.form.getValue(t);return(a&&a.includes(i)||!a)&&o&&""!==o}).forEach(e=>{this.extendJson(e,t)}),t}extendJson(e,t){const i=this.form.getValue(e);t[{crushFailureDomain:"crush-failure-domain",crushRoot:"crush-root",crushDeviceClass:"crush-device-class",packetSize:"packetsize",crushLocality:"crush-locality"}[e]||e]="crushRoot"===e?i.name:i}}return e.\u0275fac=function(t){return new(t||e)(p.Rb(R.a),p.Rb(s.a),p.Rb(E.a),p.Rb(v),p.Rb(n.b))},e.\u0275cmp=p.Lb({type:e,selectors:[["cd-erasure-code-profile-form-modal"]],outputs:{submitAction:"submitAction"},features:[p.Ab],decls:98,vars:53,consts:function(){let e,t,i,a,o,c,s,n,l,r,b,u,d,f,m,h,p,g,v,D,W,I,z,P,C,X,S,y,_,N,$,T,w,E,R,k,x,A,V,F,O,L,q,M,B,U,G,j,J;return e="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Name",i="Plugin",a="Data chunks (k)",o="Coding chunks (m)",c="Crush failure domain",s="Crush root",n="Crush device class",l="Let Ceph decide",r="Available OSDs: " + "\ufffd0\ufffd" + "",b="Directory",u="This field is required!",d="The name can only consist of alphanumeric characters, dashes and underscores.",f="The chosen erasure code profile name is already in use.",m="Loading...",h="This field is required!",p="This field is required!",g="Must be equal to or greater than 2.",v="Chunks (k+m) have exceeded the available OSDs of " + "\ufffd0\ufffd" + ".",D="For an equal distribution k has to be a multiple of (k+m)/l.",W="K has to be equal to or greater than m in order to recover data correctly through c.",I="Distribution factor: " + "\ufffd0\ufffd" + "",z="This field is required!",P="Must be equal to or greater than 1.",C="Chunks (k+m) have exceeded the available OSDs of " + "\ufffd0\ufffd" + ".",X="Durability estimator (c)",S="Must be equal to or greater than 1.",y="C has to be equal to or lower than m as m defines the amount of chunks that can be used.",_="Helper chunks (d)",N="Set d manually or use the plugin's default calculation that maximizes d.",$="D is automatically updated on k and m changes",T="D can be set from " + "\ufffd0\ufffd" + " to " + "\ufffd1\ufffd" + "",w="D can only be set to " + "\ufffd0\ufffd" + "",E="D has to be greater than k (" + "\ufffd0\ufffd" + ").",R="D has to be lower than k + m (" + "\ufffd0\ufffd" + ").",k="Locality (l)",x="Locality groups: " + "\ufffd0\ufffd" + "",A="This field is required!",V="Must be equal to or greater than 1.",F="Can't split up chunks (k+m) correctly with the current locality.",O="Loading...",L="Crush Locality",q="Loading...",M="None",B="Scalar mds",U="Technique",G="Packetsize",j="Must be equal to or greater than 1.",J="Loading...",[[3,"modalRef"],[1,"modal-title"],e,[1,"modal-content"],["novalidate","",3,"formGroup"],["frm","ngForm"],[1,"modal-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label"],t,[1,"cd-col-form-input"],["type","text","id","name","name","name","placeholder","Name...","formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","plugin",1,"cd-col-form-label"],[1,"required"],i,[3,"html"],["id","plugin","name","plugin","formControlName","plugin",1,"form-control","custom-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],["for","k",1,"cd-col-form-label"],a,["type","number","id","k","name","k","ng-model","$ctrl.erasureCodeProfile.k","placeholder","Data chunks...","formControlName","k",1,"form-control"],["class","form-text text-muted",4,"ngIf"],["for","m",1,"cd-col-form-label"],o,["type","number","id","m","name","m","placeholder","Coding chunks...","formControlName","m",1,"form-control"],["class","form-group row",4,"ngIf"],["for","crushFailureDomain",1,"cd-col-form-label"],c,["id","crushFailureDomain","name","crushFailureDomain","formControlName","crushFailureDomain",1,"form-control","custom-select"],["for","crushRoot",1,"cd-col-form-label"],s,["id","crushRoot","name","crushRoot","formControlName","crushRoot",1,"form-control","custom-select"],["for","crushDeviceClass",1,"cd-col-form-label"],n,["id","crushDeviceClass","name","crushDeviceClass","formControlName","crushDeviceClass",1,"form-control","custom-select"],["ngValue",""],l,[1,"form-text","text-muted"],r,["for","directory",1,"cd-col-form-label"],b,["type","text","id","directory","name","directory","placeholder","Path...","formControlName","directory",1,"form-control"],[1,"modal-footer"],[3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],u,d,f,m,[3,"ngValue"],h,p,g,v,D,W,I,z,P,C,["for","c",1,"cd-col-form-label"],X,["type","number","id","c","name","c","placeholder","Coding chunks...","formControlName","c",1,"form-control"],S,y,["for","d",1,"cd-col-form-label"],_,[1,"input-group"],["type","number","id","d","name","d","placeholder","Helper chunks...","formControlName","d",1,"form-control"],[1,"input-group-append"],["id","d-calc-btn","ngbTooltip",N,"type","button",1,"btn","btn-light",3,"click"],["aria-hidden","true",3,"ngClass"],[4,"ngIf"],$,T,w,E,R,["for","l",1,"cd-col-form-label"],k,["type","number","id","l","name","l","placeholder","Coding chunks...","formControlName","l",1,"form-control"],x,A,V,F,O,["for","crushLocality",1,"cd-col-form-label"],L,["id","crushLocality","name","crushLocality","formControlName","crushLocality",1,"form-control","custom-select"],q,M,["for","scalar_mds",1,"cd-col-form-label"],B,["id","scalar_mds","name","scalar_mds","formControlName","scalar_mds",1,"form-control","custom-select"],["for","technique",1,"cd-col-form-label"],U,["id","technique","name","technique","formControlName","technique",1,"form-control","custom-select"],["for","packetSize",1,"cd-col-form-label"],G,["type","number","id","packetSize","name","packetSize","placeholder","Packetsize...","formControlName","packetSize",1,"form-control"],j,J]},template:function(e,t){if(1&e&&(p.Xb(0,"cd-modal",0),p.Vb(1,1),p.bc(2,2),p.oc(3,"titlecase"),p.oc(4,"upperFirst"),p.Ub(),p.Vb(5,3),p.Xb(6,"form",4,5),p.Xb(8,"div",6),p.Xb(9,"div",7),p.Xb(10,"label",8),p.bc(11,9),p.Wb(),p.Xb(12,"div",10),p.Sb(13,"input",11),p.Pc(14,ie,2,0,"span",12),p.Pc(15,ae,2,0,"span",12),p.Pc(16,oe,2,0,"span",12),p.Wb(),p.Wb(),p.Xb(17,"div",7),p.Xb(18,"label",13),p.Xb(19,"span",14),p.bc(20,15),p.Wb(),p.Sb(21,"cd-helper",16),p.Wb(),p.Xb(22,"div",10),p.Xb(23,"select",17),p.Pc(24,ce,2,0,"option",18),p.Pc(25,se,2,2,"option",19),p.Wb(),p.Pc(26,ne,2,0,"span",12),p.Wb(),p.Wb(),p.Xb(27,"div",7),p.Xb(28,"label",20),p.Xb(29,"span",14),p.bc(30,21),p.Wb(),p.Sb(31,"cd-helper",16),p.Wb(),p.Xb(32,"div",10),p.Sb(33,"input",22),p.Pc(34,le,2,0,"span",12),p.Pc(35,re,2,0,"span",12),p.Pc(36,be,2,1,"span",12),p.Pc(37,ue,2,0,"span",12),p.Pc(38,de,2,0,"span",12),p.Pc(39,fe,2,1,"span",23),p.Wb(),p.Wb(),p.Xb(40,"div",7),p.Xb(41,"label",24),p.Xb(42,"span",14),p.bc(43,25),p.Wb(),p.Sb(44,"cd-helper",16),p.Wb(),p.Xb(45,"div",10),p.Sb(46,"input",26),p.Pc(47,me,2,0,"span",12),p.Pc(48,he,2,0,"span",12),p.Pc(49,pe,2,1,"span",12),p.Wb(),p.Wb(),p.Pc(50,De,9,3,"div",27),p.Pc(51,Se,15,6,"div",27),p.Pc(52,$e,12,5,"div",27),p.Xb(53,"div",7),p.Xb(54,"label",28),p.Vb(55),p.bc(56,29),p.Ub(),p.Sb(57,"cd-helper",16),p.Wb(),p.Xb(58,"div",10),p.Xb(59,"select",30),p.Pc(60,Te,2,0,"option",18),p.Pc(61,we,2,3,"option",19),p.Wb(),p.Wb(),p.Wb(),p.Pc(62,xe,10,4,"div",27),p.Pc(63,Fe,8,6,"div",27),p.Pc(64,Le,8,2,"div",27),p.Pc(65,Me,8,2,"div",27),p.Xb(66,"div",7),p.Xb(67,"label",31),p.Vb(68),p.bc(69,32),p.Ub(),p.Sb(70,"cd-helper",16),p.Wb(),p.Xb(71,"div",10),p.Xb(72,"select",33),p.Pc(73,Be,2,0,"option",18),p.Pc(74,Ue,2,2,"option",19),p.Wb(),p.Wb(),p.Wb(),p.Xb(75,"div",7),p.Xb(76,"label",34),p.Vb(77),p.bc(78,35),p.Ub(),p.Sb(79,"cd-helper",16),p.Wb(),p.Xb(80,"div",10),p.Xb(81,"select",36),p.Xb(82,"option",37),p.bc(83,38),p.Wb(),p.Pc(84,Ge,2,2,"option",19),p.Wb(),p.Xb(85,"span",39),p.bc(86,40),p.Wb(),p.Wb(),p.Wb(),p.Xb(87,"div",7),p.Xb(88,"label",41),p.Vb(89),p.bc(90,42),p.Ub(),p.Sb(91,"cd-helper",16),p.Wb(),p.Xb(92,"div",10),p.Sb(93,"input",43),p.Wb(),p.Wb(),p.Wb(),p.Xb(94,"div",44),p.Xb(95,"cd-form-button-panel",45),p.lc("submitActionEvent",function(){return t.onSubmit()}),p.oc(96,"titlecase"),p.oc(97,"upperFirst"),p.Wb(),p.Wb(),p.Wb(),p.Ub(),p.Wb()),2&e){const e=p.Fc(7);p.uc("modalRef",t.activeModal),p.Db(4),p.fc(p.pc(3,41,t.action))(p.pc(4,43,t.resource)),p.cc(2),p.Db(2),p.uc("formGroup",t.form),p.Db(8),p.uc("ngIf",t.form.showError("name",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"pattern")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"uniqueName")),p.Db(5),p.uc("html",t.tooltips.plugins[t.plugin].description),p.Db(3),p.uc("ngIf",!t.plugins),p.Db(1),p.uc("ngForOf",t.plugins),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"required")),p.Db(5),p.uc("html",t.tooltips.k),p.Db(3),p.uc("ngIf",t.form.showError("k",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("k",e,"min")),p.Db(1),p.uc("ngIf",t.form.showError("k",e,"max")),p.Db(1),p.uc("ngIf",t.form.showError("k",e,"unequal")),p.Db(1),p.uc("ngIf",t.form.showError("k",e,"kLowerM")),p.Db(1),p.uc("ngIf","lrc"===t.plugin),p.Db(5),p.uc("html",t.tooltips.m),p.Db(3),p.uc("ngIf",t.form.showError("m",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("m",e,"min")),p.Db(1),p.uc("ngIf",t.form.showError("m",e,"max")),p.Db(1),p.uc("ngIf","shec"===t.plugin),p.Db(1),p.uc("ngIf","clay"===t.plugin),p.Db(1),p.uc("ngIf",t.plugin===t.PLUGIN.LRC),p.Db(5),p.uc("html",t.tooltips.crushFailureDomain),p.Db(3),p.uc("ngIf",!t.failureDomains),p.Db(1),p.uc("ngForOf",t.failureDomainKeys),p.Db(1),p.uc("ngIf",t.plugin===t.PLUGIN.LRC),p.Db(1),p.uc("ngIf",t.PLUGIN.CLAY===t.plugin),p.Db(1),p.uc("ngIf",p.Bc(49,Ve,t.PLUGIN.JERASURE,t.PLUGIN.ISA,t.PLUGIN.CLAY).includes(t.plugin)),p.Db(1),p.uc("ngIf",t.plugin===t.PLUGIN.JERASURE),p.Db(5),p.uc("html",t.tooltips.crushRoot),p.Db(3),p.uc("ngIf",!t.buckets),p.Db(1),p.uc("ngForOf",t.buckets),p.Db(5),p.uc("html",t.tooltips.crushDeviceClass),p.Db(5),p.uc("ngForOf",t.devices),p.Db(2),p.fc(t.deviceCount),p.cc(86),p.Db(5),p.uc("html",t.tooltips.directory),p.Db(4),p.uc("form",t.form)("submitText",p.pc(96,45,t.action)+" "+p.pc(97,47,t.resource))}},directives:[k.a,o.B,o.r,x.a,o.k,A.a,V.a,o.d,F.a,o.q,o.i,O.a,a.r,L.a,o.z,a.q,o.v,o.u,o.C,q.a,s.D,a.p],pipes:[a.A,M.a],styles:[""]}),e})();var Je=i("DNAf");class Ke{constructor(){this.erasureInfo=!1,this.crushInfo=!1,this.pgs=1,this.poolTypes=["erasure","replicated"],this.applications={selected:[],default:["cephfs","rbd","rgw"],available:[],validators:[o.A.pattern("[A-Za-z0-9_]+"),o.A.maxLength(128)],messages:new Je.a({empty:"No applications added",selectionLimit:{text:"Applications limit reached",tooltip:"A pool can only have up to four applications definitions."},customValidations:{pattern:"Allowed characters '_a-zA-Z0-9'",maxlength:"Maximum length is 128 characters"},filter:"Filter or add applications'",add:"Add application"})}}}var Ye=i("zc8c"),He=i("ppaS"),Qe=i("EmSq"),Ze=i("rFfW"),et=i("6qls"),tt=i("FSuO");const it=["crushInfoTabs"],at=["crushDeletionBtn"],ot=["ecpInfoTabs"],ct=["ecpDeletionBtn"];function st(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,41),p.Wb())}function nt(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,42),p.Wb())}function lt(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,43),p.Wb())}function rt(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,44),p.Wb())}function bt(e,t){if(1&e&&(p.Xb(0,"option",45),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("value",e),p.Db(1),p.Tc(" ",e," ")}}function ut(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,46),p.Wb())}function dt(e,t){if(1&e&&(p.Xb(0,"option",45),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("value",e),p.Db(1),p.Tc(" ",e," ")}}function ft(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,57),p.Wb())}function mt(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,58),p.Wb())}function ht(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,59),p.Wb())}function pt(e,t){1&e&&(p.Xb(0,"span",54),p.bc(1,60),p.Wb())}function gt(e,t){if(1&e){const e=p.Yb();p.Xb(0,"div",8),p.Xb(1,"label",51),p.bc(2,52),p.Wb(),p.Xb(3,"div",11),p.Xb(4,"input",53),p.lc("focus",function(){return p.Ic(e),p.nc(3).externalPgChange=!1})("blur",function(){return p.Ic(e),p.nc(3).alignPgs()}),p.Wb(),p.Pc(5,ft,2,0,"span",13),p.Pc(6,mt,2,0,"span",13),p.Pc(7,ht,2,0,"span",13),p.Xb(8,"span",54),p.Sb(9,"cd-doc",55),p.Wb(),p.Pc(10,pt,2,0,"span",56),p.Wb(),p.Wb()}if(2&e){p.nc(2);const e=p.Fc(2),t=p.nc();p.Db(5),p.uc("ngIf",t.form.showError("pgNum",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("pgNum",e,"min")),p.Db(1),p.uc("ngIf",t.form.showError("pgNum",e,"34")),p.Db(3),p.uc("ngIf",t.externalPgChange)}}function vt(e,t){if(1&e&&(p.Xb(0,"span",40),p.Xb(1,"ul",65),p.Xb(2,"li"),p.bc(3,66),p.Wb(),p.Xb(4,"li"),p.bc(5,67),p.Wb(),p.Wb(),p.Wb()),2&e){const e=p.nc(4);p.Db(3),p.fc(e.getMinSize()),p.cc(3),p.Db(2),p.fc(e.getMaxSize()),p.cc(5)}}function Dt(e,t){if(1&e&&(p.Xb(0,"span",40),p.bc(1,68),p.Wb()),2&e){const e=p.nc(4);p.Db(1),p.fc(e.getMinSize())(e.getMaxSize()),p.cc(1)}}function Wt(e,t){1&e&&(p.Xb(0,"span",69),p.bc(1,70),p.Wb())}function It(e,t){if(1&e&&(p.Xb(0,"div",8),p.Xb(1,"label",61),p.bc(2,62),p.Wb(),p.Xb(3,"div",11),p.Sb(4,"input",63),p.Pc(5,vt,6,2,"span",13),p.Pc(6,Dt,2,2,"span",13),p.Pc(7,Wt,2,0,"span",64),p.Wb(),p.Wb()),2&e){p.nc(2);const e=p.Fc(2),t=p.nc();p.Db(4),p.uc("max",t.getMaxSize())("min",t.getMinSize()),p.Db(1),p.uc("ngIf",t.form.showError("size",e)),p.Db(1),p.uc("ngIf",t.form.showError("size",e)),p.Db(1),p.uc("ngIf",1===t.form.getValue("size"))}}function zt(e,t){1&e&&(p.Xb(0,"div",8),p.Xb(1,"label",71),p.bc(2,72),p.Wb(),p.Xb(3,"div",11),p.Xb(4,"div",73),p.Sb(5,"input",74),p.Xb(6,"label",75),p.bc(7,76),p.Wb(),p.Wb(),p.Wb(),p.Wb())}function Pt(e,t){if(1&e&&(p.Xb(0,"div"),p.Xb(1,"div",8),p.Xb(2,"label",47),p.bc(3,48),p.Wb(),p.Xb(4,"div",11),p.Xb(5,"select",49),p.Pc(6,dt,2,2,"option",19),p.Wb(),p.Wb(),p.Wb(),p.Pc(7,gt,11,4,"div",50),p.Pc(8,It,8,5,"div",50),p.Pc(9,zt,8,0,"div",50),p.Wb()),2&e){const e=p.nc(2);p.Db(6),p.uc("ngForOf",e.pgAutoscaleModes),p.Db(1),p.uc("ngIf","on"!==e.form.getValue("pgAutoscaleMode")),p.Db(1),p.uc("ngIf",e.isReplicated),p.Db(1),p.uc("ngIf",e.info.is_all_bluestore&&e.isErasure)}}function Ct(e,t){1&e&&(p.Xb(0,"option",17),p.bc(1,91),p.Wb())}function Xt(e,t){1&e&&(p.Xb(0,"option",92),p.bc(1,93),p.Wb()),2&e&&p.uc("ngValue",null)}function St(e,t){1&e&&(p.Xb(0,"option",92),p.bc(1,94),p.Wb()),2&e&&p.uc("ngValue",null)}function yt(e,t){if(1&e&&(p.Xb(0,"option",92),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e.name," ")}}const _t=function(e){return[e]};function Nt(e,t){if(1&e){const e=p.Yb();p.Xb(0,"button",95),p.lc("click",function(){return p.Ic(e),p.nc(4).addErasureCodeProfile()}),p.Sb(1,"i",87),p.Wb()}if(2&e){const e=p.nc(4);p.Db(1),p.uc("ngClass",p.zc(1,_t,e.icons.add))}}function $t(e,t){if(1&e){const e=p.Yb();p.Xb(0,"button",96,97),p.lc("click",function(){return p.Ic(e),p.nc(4).deleteErasureCodeProfile()}),p.Sb(2,"i",87),p.Wb()}if(2&e){const e=p.nc(4);p.Db(2),p.uc("ngClass",p.zc(1,_t,e.icons.trash))}}const Tt=function(){return["name"]};function wt(e,t){if(1&e&&p.Sb(0,"cd-table-key-value",108),2&e){const e=p.nc(5);p.uc("renderObjects",!0)("hideKeys",p.yc(4,Tt))("data",e.form.getValue("erasureProfile"))("autoReload",!1)}}function Et(e,t){1&e&&(p.Xb(0,"span"),p.bc(1,111),p.Wb())}function Rt(e,t){if(1&e&&(p.Xb(0,"li"),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.Db(1),p.Tc(" ",e," ")}}function kt(e,t){if(1&e&&(p.Xb(0,"ul"),p.Pc(1,Rt,2,1,"li",112),p.Wb()),2&e){const e=p.nc(6);p.Db(1),p.uc("ngForOf",e.ecpUsage)}}function xt(e,t){if(1&e&&(p.Pc(0,Et,2,0,"ng-template",null,109,p.Qc),p.Pc(2,kt,2,1,"ul",110)),2&e){const e=p.Fc(1),t=p.nc(5);p.Db(2),p.uc("ngIf",t.ecpUsage)("ngIfElse",e)}}function At(e,t){if(1&e&&(p.Xb(0,"span",98),p.Xb(1,"ul",99,100),p.Xb(3,"li",101),p.Xb(4,"a",102),p.bc(5,103),p.Wb(),p.Pc(6,wt,1,5,"ng-template",104),p.Wb(),p.Xb(7,"li",105),p.Xb(8,"a",102),p.bc(9,106),p.Wb(),p.Pc(10,xt,3,2,"ng-template",104),p.Wb(),p.Wb(),p.Sb(11,"div",107),p.Wb()),2&e){const e=p.Fc(2);p.Db(11),p.uc("ngbNavOutlet",e)}}const Vt=function(e){return{active:e}};function Ft(e,t){if(1&e){const e=p.Yb();p.Xb(0,"div",8),p.Xb(1,"label",78),p.bc(2,79),p.Wb(),p.Xb(3,"div",11),p.Xb(4,"div",80),p.Xb(5,"select",81),p.Pc(6,Ct,2,0,"option",82),p.Pc(7,Xt,2,1,"option",83),p.Pc(8,St,2,1,"option",83),p.Pc(9,yt,2,2,"option",84),p.Wb(),p.Xb(10,"span",85),p.Xb(11,"button",86),p.lc("click",function(){p.Ic(e);const t=p.nc(3);return t.data.erasureInfo=!t.data.erasureInfo}),p.Sb(12,"i",87),p.Wb(),p.Pc(13,Nt,2,3,"button",88),p.Pc(14,$t,3,3,"button",89),p.Wb(),p.Wb(),p.Pc(15,At,12,1,"span",90),p.Wb(),p.Wb()}if(2&e){const e=p.nc(3);p.Db(6),p.uc("ngIf",!e.ecProfiles),p.Db(1),p.uc("ngIf",e.ecProfiles&&0===e.ecProfiles.length),p.Db(1),p.uc("ngIf",e.ecProfiles&&e.ecProfiles.length>0),p.Db(1),p.uc("ngForOf",e.ecProfiles),p.Db(2),p.uc("ngClass",p.zc(9,Vt,e.data.erasureInfo)),p.Db(1),p.uc("ngClass",p.zc(11,_t,e.icons.questionCircle)),p.Db(1),p.uc("ngIf",!e.editing),p.Db(1),p.uc("ngIf",!e.editing),p.Db(1),p.uc("ngIf",e.data.erasureInfo&&e.form.getValue("erasureProfile"))}}function Ot(e,t){1&e&&(p.Xb(0,"div",8),p.Xb(1,"label",113),p.bc(2,114),p.Wb(),p.Xb(3,"div",11),p.Xb(4,"span",54),p.bc(5,115),p.Wb(),p.Wb(),p.Wb())}function Lt(e,t){1&e&&(p.Xb(0,"span",54),p.Xb(1,"span"),p.bc(2,118),p.Wb(),p.Rc(3,"\xa0 "),p.Wb())}function qt(e,t){if(1&e&&(p.Xb(0,"option",92),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("ngValue",e),p.Db(1),p.Tc(" ",e.rule_name," ")}}function Mt(e,t){if(1&e){const e=p.Yb();p.Xb(0,"button",95),p.lc("click",function(){return p.Ic(e),p.nc(5).addCrushRule()}),p.Sb(1,"i",87),p.Wb()}if(2&e){const e=p.nc(5);p.Db(1),p.uc("ngClass",p.zc(1,_t,e.icons.add))}}function Bt(e,t){if(1&e){const e=p.Yb();p.Xb(0,"button",124,125),p.lc("click",function(){return p.Ic(e),p.nc(5).deleteCrushRule()}),p.Sb(2,"i",87),p.Wb()}if(2&e){const e=p.nc(5);p.Db(2),p.uc("ngClass",p.zc(1,_t,e.icons.trash))}}const Ut=function(){return["steps","ruleset","type","rule_name"]};function Gt(e,t){if(1&e&&p.Sb(0,"cd-table-key-value",108),2&e){const e=p.nc(6);p.uc("renderObjects",!1)("hideKeys",p.yc(4,Ut))("data",e.form.getValue("crushRule"))("autoReload",!1)}}function jt(e,t){if(1&e&&(p.Xb(0,"li"),p.Rc(1),p.Wb()),2&e){const e=t.$implicit,i=p.nc(7);p.Db(1),p.Tc(" ",i.describeCrushStep(e)," ")}}function Jt(e,t){if(1&e&&(p.Xb(0,"ol"),p.Pc(1,jt,2,1,"li",112),p.Wb()),2&e){const e=p.nc(6);p.Db(1),p.uc("ngForOf",e.form.get("crushRule").value.steps)}}function Kt(e,t){1&e&&(p.Xb(0,"span"),p.bc(1,134),p.Wb())}function Yt(e,t){if(1&e&&(p.Xb(0,"li"),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.Db(1),p.Tc(" ",e," ")}}function Ht(e,t){if(1&e&&(p.Xb(0,"ul"),p.Pc(1,Yt,2,1,"li",112),p.Wb()),2&e){const e=p.nc(7);p.Db(1),p.uc("ngForOf",e.crushUsage)}}function Qt(e,t){if(1&e&&(p.Pc(0,Kt,2,0,"ng-template",null,133,p.Qc),p.Pc(2,Ht,2,1,"ul",110)),2&e){const e=p.Fc(1),t=p.nc(6);p.Db(2),p.uc("ngIf",t.crushUsage)("ngIfElse",e)}}function Zt(e,t){if(1&e&&(p.Xb(0,"div",126),p.Xb(1,"ul",99,127),p.Xb(3,"li",128),p.Xb(4,"a",102),p.bc(5,129),p.Wb(),p.Pc(6,Gt,1,5,"ng-template",104),p.Wb(),p.Xb(7,"li",130),p.Xb(8,"a",102),p.bc(9,131),p.Wb(),p.Pc(10,Jt,2,1,"ng-template",104),p.Wb(),p.Xb(11,"li",105),p.Xb(12,"a",102),p.bc(13,132),p.Wb(),p.Pc(14,Qt,3,2,"ng-template",104),p.Wb(),p.Wb(),p.Sb(15,"div",107),p.Wb()),2&e){const e=p.Fc(2);p.Db(15),p.uc("ngbNavOutlet",e)}}function ei(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,135),p.Wb())}function ti(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,136),p.Wb())}function ii(e,t){if(1&e){const e=p.Yb();p.Xb(0,"div"),p.Xb(1,"div",80),p.Xb(2,"select",119),p.Xb(3,"option",92),p.bc(4,120),p.Wb(),p.Pc(5,qt,2,2,"option",84),p.Wb(),p.Xb(6,"span",85),p.Xb(7,"button",121),p.lc("click",function(){p.Ic(e);const t=p.nc(4);return t.data.crushInfo=!t.data.crushInfo}),p.Sb(8,"i",87),p.Wb(),p.Pc(9,Mt,2,3,"button",88),p.Pc(10,Bt,3,3,"button",122),p.Wb(),p.Wb(),p.Pc(11,Zt,16,1,"div",123),p.Pc(12,ei,2,0,"span",13),p.Pc(13,ti,2,0,"span",13),p.Wb()}if(2&e){p.nc(3);const e=p.Fc(2),t=p.nc();p.Db(3),p.uc("ngValue",null),p.Db(2),p.uc("ngForOf",t.current.rules),p.Db(2),p.uc("ngClass",p.zc(9,Vt,t.data.crushInfo)),p.Db(1),p.uc("ngClass",p.zc(11,_t,t.icons.questionCircle)),p.Db(1),p.uc("ngIf",t.isReplicated&&!t.editing),p.Db(1),p.uc("ngIf",t.isReplicated&&!t.editing),p.Db(1),p.uc("ngIf",t.data.crushInfo&&t.form.getValue("crushRule")),p.Db(1),p.uc("ngIf",t.form.showError("crushRule",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("crushRule",e,"tooFewOsds"))}}function ai(e,t){if(1&e&&(p.Xb(0,"div",8),p.Xb(1,"label",113),p.bc(2,116),p.Wb(),p.Xb(3,"div",11),p.Pc(4,Lt,4,0,"ng-template",null,117,p.Qc),p.Pc(6,ii,14,13,"div",110),p.Wb(),p.Wb()),2&e){const e=p.Fc(5),t=p.nc(3);p.Db(6),p.uc("ngIf",t.current.rules.length>0)("ngIfElse",e)}}function oi(e,t){if(1&e&&(p.Xb(0,"div"),p.Xb(1,"legend"),p.bc(2,77),p.Wb(),p.Pc(3,Ft,16,13,"div",50),p.Pc(4,Ot,6,0,"div",50),p.Pc(5,ai,7,2,"div",50),p.Wb()),2&e){const e=p.nc(2);p.Db(3),p.uc("ngIf",e.isErasure),p.Db(1),p.uc("ngIf",e.isErasure&&!e.editing),p.Db(1),p.uc("ngIf",e.isReplicated||e.editing)}}function ci(e,t){if(1&e&&(p.Xb(0,"option",45),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("value",e),p.Db(1),p.Tc(" ",e," ")}}function si(e,t){1&e&&(p.Xb(0,"option",17),p.bc(1,154),p.Wb())}function ni(e,t){1&e&&(p.Xb(0,"option",17),p.bc(1,155),p.Wb())}function li(e,t){if(1&e&&(p.Xb(0,"option",45),p.Rc(1),p.Wb()),2&e){const e=t.$implicit;p.uc("value",e),p.Db(1),p.Tc(" ",e," ")}}function ri(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,156),p.Wb())}function bi(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,157),p.Wb())}function ui(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,158),p.Wb())}function di(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,159),p.Wb())}function fi(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,160),p.Wb())}function mi(e,t){if(1&e&&(p.Xb(0,"div"),p.Xb(1,"div",8),p.Xb(2,"label",142),p.bc(3,143),p.Wb(),p.Xb(4,"div",11),p.Xb(5,"select",144),p.Pc(6,si,2,0,"option",82),p.Pc(7,ni,2,0,"option",82),p.Pc(8,li,2,2,"option",19),p.Wb(),p.Wb(),p.Wb(),p.Xb(9,"div",8),p.Xb(10,"label",145),p.bc(11,146),p.Wb(),p.Xb(12,"div",11),p.Sb(13,"input",147),p.Pc(14,ri,2,0,"span",13),p.Pc(15,bi,2,0,"span",13),p.Wb(),p.Wb(),p.Xb(16,"div",8),p.Xb(17,"label",148),p.bc(18,149),p.Wb(),p.Xb(19,"div",11),p.Sb(20,"input",150),p.Pc(21,ui,2,0,"span",13),p.Pc(22,di,2,0,"span",13),p.Wb(),p.Wb(),p.Xb(23,"div",8),p.Xb(24,"label",151),p.bc(25,152),p.Wb(),p.Xb(26,"div",11),p.Sb(27,"input",153),p.Pc(28,fi,2,0,"span",13),p.Wb(),p.Wb(),p.Wb()),2&e){p.nc(2);const e=p.Fc(2),t=p.nc();p.Db(6),p.uc("ngIf",!t.info.compression_algorithms),p.Db(1),p.uc("ngIf",t.info.compression_algorithms&&0===t.info.compression_algorithms.length),p.Db(1),p.uc("ngForOf",t.info.compression_algorithms),p.Db(6),p.uc("ngIf",t.form.showError("minBlobSize",e,"min")),p.Db(1),p.uc("ngIf",t.form.showError("minBlobSize",e,"maximum")),p.Db(6),p.uc("ngIf",t.form.showError("maxBlobSize",e,"min")),p.Db(1),p.uc("ngIf",t.form.showError("maxBlobSize",e,"minimum")),p.Db(6),p.uc("ngIf",t.form.showError("ratio",e,"min")||t.form.showError("ratio",e,"max"))}}function hi(e,t){if(1&e&&(p.Xb(0,"div",137),p.Xb(1,"legend"),p.bc(2,138),p.Wb(),p.Xb(3,"div",8),p.Xb(4,"label",139),p.bc(5,140),p.Wb(),p.Xb(6,"div",11),p.Xb(7,"select",141),p.Pc(8,ci,2,2,"option",19),p.Wb(),p.Wb(),p.Wb(),p.Pc(9,mi,29,8,"div",20),p.Wb()),2&e){const e=p.nc(2);p.Db(8),p.uc("ngForOf",e.info.compression_modes),p.Db(1),p.uc("ngIf",e.hasCompressionEnabled())}}function pi(e,t){1&e&&(p.Xb(0,"span",40),p.bc(1,161),p.Wb())}function gi(e,t){if(1&e){const e=p.Yb();p.Xb(0,"div",1),p.Xb(1,"form",2,3),p.Xb(3,"div",4),p.Xb(4,"div",5),p.bc(5,6),p.oc(6,"titlecase"),p.oc(7,"upperFirst"),p.Wb(),p.Xb(8,"div",7),p.Xb(9,"div",8),p.Xb(10,"label",9),p.bc(11,10),p.Wb(),p.Xb(12,"div",11),p.Sb(13,"input",12),p.Pc(14,st,2,0,"span",13),p.Pc(15,nt,2,0,"span",13),p.Pc(16,lt,2,0,"span",13),p.Pc(17,rt,2,0,"span",13),p.Wb(),p.Wb(),p.Xb(18,"div",8),p.Xb(19,"label",14),p.bc(20,15),p.Wb(),p.Xb(21,"div",11),p.Xb(22,"select",16),p.Xb(23,"option",17),p.bc(24,18),p.Wb(),p.Pc(25,bt,2,2,"option",19),p.Wb(),p.Pc(26,ut,2,0,"span",13),p.Wb(),p.Wb(),p.Pc(27,Pt,10,4,"div",20),p.Xb(28,"div",8),p.Xb(29,"label",21),p.bc(30,22),p.Wb(),p.Xb(31,"div",11),p.Xb(32,"cd-select-badges",23),p.lc("selection",function(){return p.Ic(e),p.nc().appSelection()}),p.Wb(),p.Wb(),p.Wb(),p.Pc(33,oi,6,3,"div",20),p.Pc(34,hi,10,2,"div",24),p.Xb(35,"div"),p.Xb(36,"legend"),p.bc(37,25),p.Wb(),p.Xb(38,"div",8),p.Xb(39,"label",26),p.Vb(40),p.bc(41,27),p.Ub(),p.Xb(42,"cd-helper"),p.Xb(43,"span"),p.bc(44,28),p.Wb(),p.Sb(45,"br"),p.Xb(46,"span"),p.bc(47,29),p.Wb(),p.Wb(),p.Wb(),p.Xb(48,"div",11),p.Sb(49,"input",30),p.Wb(),p.Wb(),p.Xb(50,"div",8),p.Xb(51,"label",31),p.Vb(52),p.bc(53,32),p.Ub(),p.Xb(54,"cd-helper"),p.Xb(55,"span"),p.bc(56,33),p.Wb(),p.Sb(57,"br"),p.Xb(58,"span"),p.bc(59,34),p.Wb(),p.Wb(),p.Wb(),p.Xb(60,"div",11),p.Sb(61,"input",35),p.Pc(62,pi,2,0,"span",13),p.Wb(),p.Wb(),p.Wb(),p.Xb(63,"div",36),p.Xb(64,"cd-rbd-configuration-form",37),p.lc("changes",function(t){return p.Ic(e),p.nc().currentConfigurationValues=t()}),p.Wb(),p.Wb(),p.Wb(),p.Xb(65,"div",38),p.Xb(66,"cd-form-button-panel",39),p.lc("submitActionEvent",function(){return p.Ic(e),p.nc().submit()}),p.oc(67,"titlecase"),p.oc(68,"upperFirst"),p.Wb(),p.Wb(),p.Wb(),p.Wb(),p.Wb()}if(2&e){const e=p.Fc(2),t=p.nc();p.Db(1),p.uc("formGroup",t.form),p.Db(6),p.fc(p.pc(6,24,t.action))(p.pc(7,26,t.resource)),p.cc(5),p.Db(7),p.uc("ngIf",t.form.showError("name",e,"required")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"uniqueName")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"rbdPool")),p.Db(1),p.uc("ngIf",t.form.showError("name",e,"pattern")),p.Db(8),p.uc("ngForOf",t.data.poolTypes),p.Db(1),p.uc("ngIf",t.form.showError("poolType",e,"required")),p.Db(1),p.uc("ngIf",t.isReplicated||t.isErasure),p.Db(5),p.uc("customBadges",!0)("customBadgeValidators",t.data.applications.validators)("messages",t.data.applications.messages)("data",t.data.applications.selected)("options",t.data.applications.available)("selectionLimit",4),p.Db(1),p.uc("ngIf",t.isErasure||t.isReplicated),p.Db(1),p.uc("ngIf",t.info.is_all_bluestore),p.Db(28),p.uc("ngIf",t.form.showError("max_objects",e,"min")),p.Db(1),p.uc("hidden",t.isErasure||-1===t.data.applications.selected.indexOf("rbd")),p.Db(1),p.uc("form",t.form)("initializeData",t.initializeConfigData),p.Db(2),p.uc("form",t.form)("submitText",p.pc(67,28,t.action)+" "+p.pc(68,30,t.resource))}}let vi=(()=>{class e extends C.a{constructor(e,t,i,a,o,c,s,l,r,b,u){super(),this.dimlessBinaryPipe=e,this.route=t,this.router=i,this.modalService=a,this.poolService=o,this.authStorageService=c,this.formatter=s,this.taskWrapper=l,this.ecpService=r,this.crushRuleService=b,this.actionLabels=u,this.editing=!1,this.isReplicated=!1,this.isErasure=!1,this.data=new Ke,this.externalPgChange=!1,this.current={rules:[]},this.initializeConfigData=new f.a(1),this.currentConfigurationValues={},this.icons=P.a,this.crushUsage=void 0,this.ecpUsage=void 0,this.editing=this.router.url.startsWith(`/pool/${n.e.EDIT}`),this.action=this.editing?this.actionLabels.EDIT:this.actionLabels.CREATE,this.resource="pool",this.authenticate(),this.createForm()}authenticate(){if(this.permission=this.authStorageService.getPermissions().pool,!this.permission.read||!this.permission.update&&this.editing||!this.permission.create&&!this.editing)throw new m.b}createForm(){const e=new X.a({mode:new o.h("none"),algorithm:new o.h(""),minBlobSize:new o.h("",{updateOn:"blur"}),maxBlobSize:new o.h("",{updateOn:"blur"}),ratio:new o.h("",{updateOn:"blur"})});this.form=new X.a({name:new o.h("",{validators:[o.A.pattern(/^[.A-Za-z0-9_/-]+$/),o.A.required,S.a.custom("rbdPool",()=>this.form&&this.form.getValue("name").includes("/")&&this.data&&-1!==this.data.applications.selected.indexOf("rbd"))]}),poolType:new o.h("",{validators:[o.A.required]}),crushRule:new o.h(null,{validators:[S.a.custom("tooFewOsds",e=>this.info&&e&&this.info.osd_count<e.min_size),S.a.custom("required",e=>this.isReplicated&&this.info.crush_rules_replicated.length>0&&!e)]}),size:new o.h("",{updateOn:"blur"}),erasureProfile:new o.h(null),pgNum:new o.h("",{validators:[o.A.required,o.A.min(1)]}),pgAutoscaleMode:new o.h(null),ecOverwrites:new o.h(!1),compression:e,max_bytes:new o.h(""),max_objects:new o.h(0,{validators:[o.A.min(0)]})},[S.a.custom("form",()=>null)])}ngOnInit(){this.poolService.getInfo().subscribe(e=>{this.initInfo(e),this.editing?this.initEditMode():(this.setAvailableApps(),this.loadingReady()),this.listenToChanges(),this.setComplexValidators()})}initInfo(e){this.pgAutoscaleModes=e.pg_autoscale_modes,this.form.silentSet("pgAutoscaleMode",e.pg_autoscale_default_mode),this.form.silentSet("algorithm",e.bluestore_compression_algorithm),this.info=e,this.initEcp(e.erasure_code_profiles)}initEcp(e){this.setListControlStatus("erasureProfile",e),this.ecProfiles=e}setListControlStatus(e,t){const i=this.form.get(e),a=i.value;1!==t.length||a&&d.a.isEqual(a,t[0])?0===t.length&&a&&i.setValue(null):i.setValue(t[0]),t.length<=1?i.enabled&&i.disable():i.disabled&&i.enable()}initEditMode(){this.disableForEdit(),this.routeParamsSubscribe=this.route.params.subscribe(e=>this.poolService.get(e.name).subscribe(e=>{this.data.pool=e,this.initEditFormData(e),this.loadingReady()}))}disableForEdit(){["poolType","crushRule","size","erasureProfile","ecOverwrites"].forEach(e=>this.form.get(e).disable())}initEditFormData(e){this.initializeConfigData.next({initialData:e.configuration,sourceType:y.a.pool}),this.poolTypeChange(e.type);const t=this.info.crush_rules_replicated.concat(this.info.crush_rules_erasure),i={name:e.pool_name,poolType:e.type,crushRule:t.find(t=>t.rule_name===e.crush_rule),size:e.size,erasureProfile:this.ecProfiles.find(t=>t.name===e.erasure_code_profile),pgAutoscaleMode:e.pg_autoscale_mode,pgNum:e.pg_num,ecOverwrites:e.flags_names.includes("ec_overwrites"),mode:e.options.compression_mode,algorithm:e.options.compression_algorithm,minBlobSize:this.dimlessBinaryPipe.transform(e.options.compression_min_blob_size),maxBlobSize:this.dimlessBinaryPipe.transform(e.options.compression_max_blob_size),ratio:e.options.compression_required_ratio,max_bytes:this.dimlessBinaryPipe.transform(e.quota_max_bytes),max_objects:e.quota_max_objects};Object.keys(i).forEach(e=>{const t=i[e];d.a.isUndefined(t)||""===t||this.form.silentSet(e,t)}),this.data.pgs=this.form.getValue("pgNum"),this.setAvailableApps(this.data.applications.default.concat(e.application_metadata)),this.data.applications.selected=e.application_metadata}setAvailableApps(e=this.data.applications.default){this.data.applications.available=d.a.uniq(e.sort()).map(e=>new z.a(!1,e,""))}listenToChanges(){this.listenToChangesDuringAddEdit(),this.editing||this.listenToChangesDuringAdd()}listenToChangesDuringAddEdit(){this.form.get("pgNum").valueChanges.subscribe(e=>{const t=e-this.data.pgs;1===Math.abs(t)&&2!==e?this.doPgPowerJump(t):this.data.pgs=e})}doPgPowerJump(e){const t=this.calculatePgPower()+e;this.setPgs(-1===e?Math.round(t):Math.floor(t))}calculatePgPower(e=this.form.getValue("pgNum")){return Math.log(e)/Math.log(2)}setPgs(e){const t=Math.pow(2,e<0?0:e);this.data.pgs=t,this.form.silentSet("pgNum",t)}listenToChangesDuringAdd(){this.form.get("poolType").valueChanges.subscribe(e=>{this.poolTypeChange(e)}),this.form.get("crushRule").valueChanges.subscribe(e=>{this.crushDeletionBtn&&this.crushDeletionBtn.isOpen()&&this.crushDeletionBtn.close(),e&&(this.setCorrectMaxSize(e),this.crushRuleIsUsedBy(e.rule_name),this.replicatedRuleChange(),this.pgCalc())}),this.form.get("size").valueChanges.subscribe(()=>{this.pgCalc()}),this.form.get("erasureProfile").valueChanges.subscribe(e=>{this.ecpDeletionBtn&&this.ecpDeletionBtn.isOpen()&&this.ecpDeletionBtn.close(),e&&(this.ecpIsUsedBy(e.name),this.pgCalc())}),this.form.get("mode").valueChanges.subscribe(()=>{["minBlobSize","maxBlobSize","ratio"].forEach(e=>{this.form.get(e).updateValueAndValidity({emitEvent:!1})})}),this.form.get("minBlobSize").valueChanges.subscribe(()=>{this.form.get("maxBlobSize").updateValueAndValidity({emitEvent:!1})}),this.form.get("maxBlobSize").valueChanges.subscribe(()=>{this.form.get("minBlobSize").updateValueAndValidity({emitEvent:!1})})}poolTypeChange(e){if("replicated"===e?this.setTypeBooleans(!0,!1):this.setTypeBooleans(!1,"erasure"===e),!e||!this.info)return void(this.current.rules=[]);const t=this.info["crush_rules_"+e]||[];this.current.rules=t,this.editing||(this.isReplicated&&this.setListControlStatus("crushRule",t),this.replicatedRuleChange(),this.pgCalc())}setTypeBooleans(e,t){this.isReplicated=e,this.isErasure=t}replicatedRuleChange(){if(!this.isReplicated)return;const e=this.form.get("size");let t=this.form.getValue("size")||3;const i=this.getMinSize(),a=this.getMaxSize();t<i?t=i:t>a&&(t=a),t!==e.value&&this.form.silentSet("size",t)}getMinSize(){if(!this.info||this.info.osd_count<1)return 0;const e=this.form.getValue("crushRule");return e?e.min_size:1}getMaxSize(){const e=this.form.getValue("crushRule");return this.info?e?e.usable_size:Math.min(this.info.osd_count,3):0}pgCalc(){const e=this.form.getValue("poolType");if(!this.info||this.form.get("pgNum").dirty||!e)return;const t=100*this.info.osd_count,i=this.isReplicated?this.replicatedPgCalc(t):this.erasurePgCalc(t);if(!i)return;const a=this.data.pgs;this.alignPgs(i),this.externalPgChange||(this.externalPgChange=a!==this.data.pgs)}setCorrectMaxSize(e=this.form.getValue("crushRule")){if(!e)return;const t=W.searchFailureDomains(this.info.nodes,e.steps[0].item_name)[e.steps[1].type];e.usable_size=Math.min(t?t.length:e.max_size,e.max_size)}replicatedPgCalc(e){const t=this.form.get("size"),i=t.value;return t.valid&&i>0?e/i:0}erasurePgCalc(e){const t=this.form.get("erasureProfile"),i=t.value;return(t.valid||t.disabled)&&i?e/(i.k+i.m):0}alignPgs(e=this.form.getValue("pgNum")){this.setPgs(Math.round(this.calculatePgPower(e<1?1:e)))}setComplexValidators(){this.editing?this.form.get("name").setValidators([this.form.get("name").validator,S.a.custom("uniqueName",e=>this.data.pool&&this.info&&-1!==this.info.pool_names.indexOf(e)&&this.info.pool_names.indexOf(e)!==this.info.pool_names.indexOf(this.data.pool.pool_name))]):(S.a.validateIf(this.form.get("size"),()=>this.isReplicated,[S.a.custom("min",e=>this.form.getValue("size")&&e<this.getMinSize()),S.a.custom("max",e=>this.form.getValue("size")&&this.getMaxSize()<e)]),this.form.get("name").setValidators([this.form.get("name").validator,S.a.custom("uniqueName",e=>this.info&&-1!==this.info.pool_names.indexOf(e))])),this.setCompressionValidators()}setCompressionValidators(){S.a.validateIf(this.form.get("minBlobSize"),()=>this.hasCompressionEnabled(),[o.A.min(0),S.a.custom("maximum",e=>this.oddBlobSize(e,this.form.getValue("maxBlobSize")))]),S.a.validateIf(this.form.get("maxBlobSize"),()=>this.hasCompressionEnabled(),[o.A.min(0),S.a.custom("minimum",e=>this.oddBlobSize(this.form.getValue("minBlobSize"),e))]),S.a.validateIf(this.form.get("ratio"),()=>this.hasCompressionEnabled(),[o.A.min(0),o.A.max(1)])}oddBlobSize(e,t){const i=this.formatter.toBytes(e),a=this.formatter.toBytes(t);return Boolean(i&&a&&i>=a)}hasCompressionEnabled(){return this.form.getValue("mode")&&"none"!==this.form.get("mode").value.toLowerCase()}describeCrushStep(e){return[e.op.replace("_"," "),e.item_name||"",e.type?e.num+" type "+e.type:""].join(" ")}addErasureCodeProfile(){this.addModal(je,e=>this.reloadECPs(e))}addModal(e,t){this.hideOpenTooltips(),this.modalService.show(e).componentInstance.submitAction.subscribe(e=>{t(e.name)})}hideOpenTooltips(){const e=e=>e&&e.isOpen()&&e.close();e(this.ecpDeletionBtn),e(this.crushDeletionBtn)}reloadECPs(e){this.reloadList({newItemName:e,getInfo:()=>this.ecpService.list(),initInfo:e=>this.initEcp(e),findNewItem:()=>this.ecProfiles.find(t=>t.name===e),controlName:"erasureProfile"})}reloadList({newItemName:e,getInfo:t,initInfo:i,findNewItem:a,controlName:o}){this.modalSubscription&&this.modalSubscription.unsubscribe(),t().subscribe(t=>{if(i(t),!e)return;const c=a();c&&this.form.get(o).setValue(c)})}deleteErasureCodeProfile(){this.deletionModal({value:this.form.getValue("erasureProfile"),usage:this.ecpUsage,deletionBtn:this.ecpDeletionBtn,dataName:"erasureInfo",getTabs:()=>this.ecpInfoTabs,tabPosition:"used-by-pools",nameAttribute:"name",itemDescription:"erasure code profile",reloadFn:()=>this.reloadECPs(),deleteFn:e=>this.ecpService.delete(e),taskName:"ecp/delete"})}deletionModal({value:e,usage:t,deletionBtn:i,dataName:a,getTabs:o,tabPosition:c,nameAttribute:s,itemDescription:n,reloadFn:l,deleteFn:r,taskName:b}){if(!e)return;if(t)return i.toggle(),this.data[a]=!0,void setTimeout(()=>{const e=o();e&&e.select(c)},50);const u=e[s];this.modalService.show(I.a,{itemDescription:n,itemNames:[u],submitActionObservable:()=>{const e=r(u);return e.subscribe(()=>l()),this.taskWrapper.wrapTaskAroundCall({task:new _.a(b,{name:u}),call:e})}})}addCrushRule(){this.addModal(ee,e=>this.reloadCrushRules(e))}reloadCrushRules(e){this.reloadList({newItemName:e,getInfo:()=>this.poolService.getInfo(),initInfo:e=>{this.initInfo(e),this.poolTypeChange("replicated")},findNewItem:()=>this.info.crush_rules_replicated.find(t=>t.rule_name===e),controlName:"crushRule"})}deleteCrushRule(){this.deletionModal({value:this.form.getValue("crushRule"),usage:this.crushUsage,deletionBtn:this.crushDeletionBtn,dataName:"crushInfo",getTabs:()=>this.crushInfoTabs,tabPosition:"used-by-pools",nameAttribute:"rule_name",itemDescription:"crush rule",reloadFn:()=>this.reloadCrushRules(),deleteFn:e=>this.crushRuleService.delete(e),taskName:"crushRule/delete"})}crushRuleIsUsedBy(e){this.crushUsage=e?this.info.used_rules[e]:void 0}ecpIsUsedBy(e){this.ecpUsage=e?this.info.used_profiles[e]:void 0}submit(){if(this.form.invalid)return void this.form.setErrors({cdSubmitButton:!0});const e={pool:this.form.getValue("name")};this.assignFormFields(e,[{externalFieldName:"pool_type",formControlName:"poolType"},{externalFieldName:"pg_autoscale_mode",formControlName:"pgAutoscaleMode",editable:!0},{externalFieldName:"pg_num",formControlName:"pgNum",replaceFn:e=>"on"===this.form.getValue("pgAutoscaleMode")?1:e,editable:!0},this.isReplicated?{externalFieldName:"size",formControlName:"size"}:{externalFieldName:"erasure_code_profile",formControlName:"erasureProfile",attr:"name"},{externalFieldName:"rule_name",formControlName:"crushRule",replaceFn:e=>this.isReplicated?e&&e.rule_name:void 0},{externalFieldName:"quota_max_bytes",formControlName:"max_bytes",replaceFn:this.formatter.toBytes,editable:!0,resetValue:this.editing?0:void 0},{externalFieldName:"quota_max_objects",formControlName:"max_objects",editable:!0,resetValue:this.editing?0:void 0}]),this.info.is_all_bluestore&&(this.assignFormField(e,{externalFieldName:"flags",formControlName:"ecOverwrites",replaceFn:()=>this.isErasure?["ec_overwrites"]:void 0}),"none"!==this.form.getValue("mode")?this.assignFormFields(e,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:e=>this.hasCompressionEnabled()&&e},{externalFieldName:"compression_algorithm",formControlName:"algorithm",editable:!0},{externalFieldName:"compression_min_blob_size",formControlName:"minBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_max_blob_size",formControlName:"maxBlobSize",replaceFn:this.formatter.toBytes,editable:!0,resetValue:0},{externalFieldName:"compression_required_ratio",formControlName:"ratio",editable:!0,resetValue:0}]):this.editing&&this.assignFormFields(e,[{externalFieldName:"compression_mode",formControlName:"mode",editable:!0,replaceFn:()=>"unset"},{externalFieldName:"srcpool",formControlName:"name",editable:!0,replaceFn:()=>this.data.pool.pool_name}]));const t=this.data.applications.selected;(t.length>0||this.editing)&&(e.application_metadata=t),this.isReplicated&&!d.a.isEmpty(this.currentConfigurationValues)&&(e.configuration=this.currentConfigurationValues),this.triggerApiTask(e)}assignFormFields(e,t){t.forEach(t=>this.assignFormField(e,t))}assignFormField(e,{externalFieldName:t,formControlName:i,attr:a,replaceFn:o,editable:c,resetValue:s}){if(this.editing&&(!c||this.form.get(i).pristine))return;const n=this.form.getValue(i);let l=o?o(n):a?d.a.get(n,a):n;if(!n||!l){if(!c||d.a.isUndefined(s))return;l=s}e[t]=l}triggerApiTask(e){this.taskWrapper.wrapTaskAroundCall({task:new _.a("pool/"+(this.editing?n.e.EDIT:n.e.CREATE),{pool_name:e.hasOwnProperty("srcpool")?e.srcpool:e.pool}),call:this.poolService[this.editing?n.e.UPDATE:n.e.CREATE](e)}).subscribe({error:e=>{d.a.isObject(e.error)&&"34"===e.error.code&&this.form.get("pgNum").setErrors({34:!0}),this.form.setErrors({cdSubmitButton:!0})},complete:()=>this.router.navigate(["/pool"])})}appSelection(){this.form.get("name").updateValueAndValidity({emitEvent:!1,onlySelf:!0})}}return e.\u0275fac=function(t){return new(t||e)(p.Rb(N.a),p.Rb(c.a),p.Rb(c.e),p.Rb(w.a),p.Rb(D.a),p.Rb($.a),p.Rb(T.a),p.Rb(E.a),p.Rb(v),p.Rb(h.a),p.Rb(n.b))},e.\u0275cmp=p.Lb({type:e,selectors:[["cd-pool-form"]],viewQuery:function(e,t){if(1&e&&(p.Wc(it,1),p.Wc(at,1),p.Wc(ot,1),p.Wc(ct,1)),2&e){let e;p.Ec(e=p.mc())&&(t.crushInfoTabs=e.first),p.Ec(e=p.mc())&&(t.crushDeletionBtn=e.first),p.Ec(e=p.mc())&&(t.ecpInfoTabs=e.first),p.Ec(e=p.mc())&&(t.ecpDeletionBtn=e.first)}},features:[p.Ab],decls:1,vars:1,consts:function(){let e,t,i,a,o,c,s,n,l,r,b,u,d,f,m,h,p,g,v,D,W,I,z,P,C,X,S,y,_,N,$,T,w,E,R,k,x,A,V,F,O,L,q,M,B,U,G,j,J,K,Y,H,Q,Z,ee,te,ie,ae,oe,ce,se,ne,le,re,be,ue,de,fe,me,he,pe,ge;return e="" + "\ufffd0\ufffd" + " " + "\ufffd1\ufffd" + "",t="Name",i="Name...",a="Pool type",o="-- Select a pool type --",c="Applications",s="Quotas",n="Max bytes",l="Leave it blank or specify 0 to disable this quota.",r="A valid quota should be greater than 0.",b="e.g., 10GiB",u="Max objects",d="Leave it blank or specify 0 to disable this quota.",f="A valid quota should be greater than 0.",m="This field is required!",h="The chosen Ceph pool name is already in use.",p="It's not possible to create an RBD pool with '/' in the name. Please change the name or remove 'rbd' from the applications list.",g="Pool name can only contain letters, numbers, '.', '-', '_' or '/'.",v="This field is required!",D="PG Autoscale",W="Placement groups",I="Calculation help",z="This field is required!",P="At least one placement group is needed!",C="Your cluster can't handle this many PGs. Please recalculate the PG amount needed.",X="The current PGs settings were calculated for you, you should make sure the values suit your needs before submit.",S="Replicated size",y="Minimum: " + "\ufffd0\ufffd" + "",_="Maximum: " + "\ufffd0\ufffd" + "",N="The size specified is out of range. A value from " + "\ufffd0\ufffd" + " to " + "\ufffd1\ufffd" + " is usable.",$="A size of 1 will not create a replication of the object. The 'Replicated size' includes the object itself.",T="Flags",w="EC Overwrites",E="CRUSH",R="Erasure code profile",k="This profile can't be deleted as it is in use.",x="Loading...",A="-- No erasure code profile available --",V="-- Select an erasure code profile --",F="Profile",O="Used by pools",L="Profile is not in use.",q="Crush ruleset",M="A new crush ruleset will be implicitly created.",B="Crush ruleset",U="There are no rules.",G="-- Select a crush rule --",j="Placement and\n                            replication strategies or distribution policies that allow to\n                            specify how CRUSH places data replicas.",J="This rule can't be deleted as it is in use.",K="Crush rule",Y="Crush steps",H="Used by pools",Q="Rule is not in use.",Z="This field is required!",ee="The rule can't be used in the current cluster as it has too few OSDs to meet the minimum required OSD by this rule.",te="Compression",ie="Mode",ae="Algorithm",oe="Minimum blob size",ce="e.g., 128KiB",se="Maximum blob size",ne="e.g., 512KiB",le="Ratio",re="Compression ratio",be="Loading...",ue="-- No erasure compression algorithm available --",de="Value should be greater than 0",fe="Value should be less than the maximum blob size",me="Value should be greater than 0",he="Value should be greater than the minimum blob size",pe="Value should be between 0.0 and 1.0",ge="The value should be greater or equal to 0",[["class","cd-col-form",4,"cdFormLoading"],[1,"cd-col-form"],["name","form","novalidate","",3,"formGroup"],["formDir","ngForm"],[1,"card"],[1,"card-header"],e,[1,"card-body"],[1,"form-group","row"],["for","name",1,"cd-col-form-label","required"],t,[1,"cd-col-form-input"],["id","name","name","name","type","text","placeholder",i,"formControlName","name","autofocus","",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","poolType",1,"cd-col-form-label","required"],a,["id","poolType","formControlName","poolType","name","poolType",1,"form-control","custom-select"],["ngValue",""],o,[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["for","applications",1,"cd-col-form-label"],c,["id","applications",3,"customBadges","customBadgeValidators","messages","data","options","selectionLimit","selection"],["formGroupName","compression",4,"ngIf"],s,["for","max_bytes",1,"cd-col-form-label"],n,l,r,["id","max_bytes","name","max_bytes","type","text","formControlName","max_bytes","placeholder",b,"defaultUnit","GiB","cdDimlessBinary","",1,"form-control"],["for","max_objects",1,"cd-col-form-label"],u,d,f,["id","max_objects","min","0","name","max_objects","type","number","formControlName","max_objects",1,"form-control"],[3,"hidden"],[3,"form","initializeData","changes"],[1,"card-footer"],["wrappingClass","text-right",3,"form","submitText","submitActionEvent"],[1,"invalid-feedback"],m,h,p,g,[3,"value"],v,["for","pgAutoscaleMode",1,"cd-col-form-label"],D,["id","pgAutoscaleMode","name","pgAutoscaleMode","formControlName","pgAutoscaleMode",1,"form-control","custom-select"],["class","form-group row",4,"ngIf"],["for","pgNum",1,"cd-col-form-label","required"],W,["id","pgNum","name","pgNum","formControlName","pgNum","min","1","type","number","required","",1,"form-control",3,"focus","blur"],[1,"form-text","text-muted"],["section","pgs","docText",I],["class","form-text text-muted",4,"ngIf"],z,P,C,X,["for","size",1,"cd-col-form-label","required"],S,["id","size","name","size","type","number","formControlName","size",1,"form-control",3,"max","min"],["class","text-warning-dark",4,"ngIf"],[1,"list-inline"],y,_,N,[1,"text-warning-dark"],$,[1,"cd-col-form-label"],T,[1,"custom-control","custom-checkbox"],["type","checkbox","id","ec-overwrites","formControlName","ecOverwrites",1,"custom-control-input"],["for","ec-overwrites",1,"custom-control-label"],w,E,["for","erasureProfile",1,"cd-col-form-label"],R,[1,"input-group"],["id","erasureProfile","name","erasureProfile","formControlName","erasureProfile",1,"form-control","custom-select"],["ngValue","",4,"ngIf"],[3,"ngValue",4,"ngIf"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"input-group-append"],["id","ecp-info-button","type","button",1,"btn","btn-light",3,"ngClass","click"],["aria-hidden","true",3,"ngClass"],["class","btn btn-light","type","button",3,"click",4,"ngIf"],["class","btn btn-light","type","button","ngbTooltip",k,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","ecp-info-block",4,"ngIf"],x,[3,"ngValue"],A,V,["type","button",1,"btn","btn-light",3,"click"],["type","button","ngbTooltip",k,"triggers","manual",1,"btn","btn-light",3,"click"],["ecpDeletionBtn","ngbTooltip"],["id","ecp-info-block",1,"form-text","text-muted"],["ngbNav","",1,"nav-tabs"],["ecpInfoTabs","ngbNav"],["ngbNavItem","ecp-info"],["ngbNavLink",""],F,["ngbNavContent",""],["ngbNavItem","used-by-pools"],O,[3,"ngbNavOutlet"],[3,"renderObjects","hideKeys","data","autoReload"],["ecpIsNotUsed",""],[4,"ngIf","ngIfElse"],L,[4,"ngFor","ngForOf"],["for","crushRule",1,"cd-col-form-label"],q,M,B,["noRules",""],U,["id","crushRule","formControlName","crushRule","name","crushSet",1,"form-control","custom-select"],G,["id","crush-info-button","type","button","ngbTooltip",j,1,"btn","btn-light",3,"ngClass","click"],["class","btn btn-light","type","button","ngbTooltip",J,"triggers","manual",3,"click",4,"ngIf"],["class","form-text text-muted","id","crush-info-block",4,"ngIf"],["type","button","ngbTooltip",J,"triggers","manual",1,"btn","btn-light",3,"click"],["crushDeletionBtn","ngbTooltip"],["id","crush-info-block",1,"form-text","text-muted"],["crushInfoTabs","ngbNav"],["ngbNavItem","crush-rule-info"],K,["ngbNavItem","crush-rule-steps"],Y,H,["ruleIsNotUsed",""],Q,Z,ee,["formGroupName","compression"],te,["for","mode",1,"cd-col-form-label"],ie,["id","mode","name","mode","formControlName","mode",1,"form-control","custom-select"],["for","algorithm",1,"cd-col-form-label"],ae,["id","algorithm","name","algorithm","formControlName","algorithm",1,"form-control","custom-select"],["for","minBlobSize",1,"cd-col-form-label"],oe,["id","minBlobSize","name","minBlobSize","formControlName","minBlobSize","type","text","min","0","placeholder",ce,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","maxBlobSize",1,"cd-col-form-label"],se,["id","maxBlobSize","type","text","min","0","formControlName","maxBlobSize","placeholder",ne,"defaultUnit","KiB","cdDimlessBinary","",1,"form-control"],["for","ratio",1,"cd-col-form-label"],le,["id","ratio","name","ratio","formControlName","ratio","type","number","min","0","max","1","step","0.1","placeholder",re,1,"form-control"],be,ue,de,fe,me,he,pe,ge]},template:function(e,t){1&e&&p.Pc(0,gi,69,32,"div",0),2&e&&p.uc("cdFormLoading",t.loading)},directives:[Ye.a,o.B,o.r,x.a,o.k,A.a,V.a,o.d,F.a,o.q,o.i,O.a,a.r,o.z,o.u,o.C,a.q,He.a,L.a,Qe.a,o.v,Ze.a,q.a,o.y,et.a,o.b,a.p,s.D,s.p,s.r,s.s,s.q,s.u,tt.a,o.l],pipes:[a.A,M.a],styles:[""]}),e})();var Di=i("5+tZ"),Wi=i("d+Og"),Ii=i("MuvH"),zi=i("+fVR"),Pi=i("VxPD"),Ci=i("uIqm"),Xi=i("x38r"),Si=i("yJti"),yi=i("vCyI"),_i=i("o4+5"),Ni=i("VTlA"),$i=i("EgGo");class Ti{constructor(e){this.pool_name=e}}var wi=i("S7zO"),Ei=i("nQ07"),Ri=(i("jKX/"),i("JP8w")),ki=i("insk"),xi=i("aAWM");function Ai(e,t){if(1&e&&p.Sb(0,"cd-table-key-value",12),2&e){const e=p.nc(2);p.uc("renderObjects",!0)("data",e.poolDetails)("autoReload",!1)}}function Vi(e,t){if(1&e&&p.Sb(0,"cd-grafana",15),2&e){const e=p.nc(3);p.wc("grafanaPath","ceph-pool-detail?var-pool_name=",e.selection.pool_name,"")}}function Fi(e,t){1&e&&(p.Xb(0,"li",13),p.Xb(1,"a",5),p.bc(2,14),p.Wb(),p.Pc(3,Vi,1,1,"ng-template",7),p.Wb())}function Oi(e,t){if(1&e&&p.Sb(0,"cd-rbd-configuration-table",18),2&e){const e=p.nc(3);p.uc("data",e.selectedPoolConfiguration)}}function Li(e,t){1&e&&(p.Xb(0,"li",16),p.Xb(1,"a",5),p.bc(2,17),p.Wb(),p.Pc(3,Oi,1,1,"ng-template",7),p.Wb())}function qi(e,t){if(1&e&&p.Sb(0,"cd-table",21),2&e){const e=p.nc(3);p.uc("data",e.cacheTiers)("columns",e.cacheTierColumns)("autoSave",!1)}}function Mi(e,t){1&e&&(p.Xb(0,"li",19),p.Xb(1,"a",5),p.bc(2,20),p.Wb(),p.Pc(3,qi,1,3,"ng-template",7),p.Wb())}function Bi(e,t){if(1&e&&(p.Vb(0,1),p.Xb(1,"ul",2,3),p.Xb(3,"li",4),p.Xb(4,"a",5),p.bc(5,6),p.Wb(),p.Pc(6,Ai,1,3,"ng-template",7),p.Wb(),p.Pc(7,Fi,4,0,"li",8),p.Pc(8,Li,4,0,"li",9),p.Pc(9,Mi,4,0,"li",10),p.Wb(),p.Sb(10,"div",11),p.Ub()),2&e){const e=p.Fc(2),t=p.nc();p.Db(7),p.uc("ngIf",t.permissions.grafana.read),p.Db(1),p.uc("ngIf","replicated"===t.selection.type),p.Db(1),p.uc("ngIf",(null==t.selection.tiers?null:t.selection.tiers.length)>0),p.Db(1),p.uc("ngbNavOutlet",e)}}let Ui=(()=>{class e{constructor(e){this.poolService=e,this.cacheTierColumns=[],this.omittedPoolAttributes=["cdExecuting","cdIsBinary","stats"],this.cacheTierColumns=[{prop:"pool_name",name:"Name",flexGrow:3},{prop:"cache_mode",name:"Cache Mode",flexGrow:2},{prop:"cache_min_evict_age",name:"Min Evict Age",flexGrow:2},{prop:"cache_min_flush_age",name:"Min Flush Age",flexGrow:2},{prop:"target_max_bytes",name:"Target Max Bytes",flexGrow:2},{prop:"target_max_objects",name:"Target Max Objects",flexGrow:2}]}ngOnChanges(){this.selection&&(this.poolService.getConfiguration(this.selection.pool_name).subscribe(e=>{Ei.a.updateChanged(this,{selectedPoolConfiguration:e})}),Ei.a.updateChanged(this,{poolDetails:d.a.omit(this.selection,this.omittedPoolAttributes)}))}}return e.\u0275fac=function(t){return new(t||e)(p.Rb(D.a))},e.\u0275cmp=p.Lb({type:e,selectors:[["cd-pool-details"]],inputs:{cacheTiers:"cacheTiers",permissions:"permissions",selection:"selection"},features:[p.Bb],decls:1,vars:1,consts:function(){let e,t,i,a;return e="Details",t="Performance Details",i="Configuration",a="Cache Tiers Details",[["cdTableDetail","",4,"ngIf"],["cdTableDetail",""],["ngbNav","","cdStatefulTab","pool-details",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem","details"],["ngbNavLink",""],e,["ngbNavContent",""],["ngbNavItem","performance-details",4,"ngIf"],["ngbNavItem","configuration",4,"ngIf"],["ngbNavItem","cache-tiers-details",4,"ngIf"],[3,"ngbNavOutlet"],[3,"renderObjects","data","autoReload"],["ngbNavItem","performance-details"],t,["uid","-xyV8KCiz","grafanaStyle","three",3,"grafanaPath"],["ngbNavItem","configuration"],i,[3,"data"],["ngbNavItem","cache-tiers-details"],a,["columnMode","flex",3,"data","columns","autoSave"]]},template:function(e,t){1&e&&p.Pc(0,Bi,11,4,"ng-container",0),2&e&&p.uc("ngIf",t.selection)},directives:[a.r,s.p,Ri.a,s.r,s.s,s.q,s.u,tt.a,ki.a,xi.a,Ci.a],styles:[""],changeDetection:0}),e})();var Gi=i("GgAd");const ji=["poolUsageTpl"],Ji=["poolConfigurationSourceTpl"];function Ki(e,t){if(1&e){const e=p.Yb();p.Xb(0,"cd-table",9,10),p.lc("fetchData",function(){return p.Ic(e),p.nc().taskListService.fetch()})("setExpandedRow",function(t){return p.Ic(e),p.nc().setExpandedRow(t)})("updateSelection",function(t){return p.Ic(e),p.nc().updateSelection(t)}),p.Sb(2,"cd-table-actions",11),p.Sb(3,"cd-pool-details",12),p.Wb()}if(2&e){const e=p.nc();p.uc("data",e.pools)("columns",e.columns)("hasDetails",!0)("status",e.tableStatus)("autoReload",-1),p.Db(2),p.uc("permission",e.permissions.pool)("selection",e.selection)("tableActions",e.tableActions),p.Db(1),p.uc("selection",e.expandedRow)("permissions",e.permissions)("cacheTiers",e.cacheTiers)}}function Yi(e,t){1&e&&p.Sb(0,"cd-grafana",14),2&e&&p.uc("grafanaPath","ceph-pools-overview?")}function Hi(e,t){1&e&&(p.Xb(0,"li",2),p.Xb(1,"a",3),p.bc(2,13),p.Wb(),p.Pc(3,Yi,1,1,"ng-template",5),p.Wb())}function Qi(e,t){if(1&e&&p.Sb(0,"cd-usage-bar",16),2&e){const e=p.nc().row;p.uc("total",e.stats.bytes_used.latest+e.stats.avail_raw.latest)("used",e.stats.bytes_used.latest)}}function Zi(e,t){if(1&e&&p.Pc(0,Qi,1,2,"cd-usage-bar",15),2&e){const e=t.row;p.uc("ngIf",null==e.stats||null==e.stats.avail_raw?null:e.stats.avail_raw.latest)}}let ea=(()=>{class e extends zi.a{constructor(e,t,i,a,o,c,s,n,l,r,b){super(),this.poolService=e,this.taskWrapper=t,this.ecpService=i,this.authStorageService=a,this.taskListService=o,this.modalService=c,this.pgCategoryService=s,this.dimlessPipe=n,this.urlBuilder=l,this.configurationService=r,this.actionLabels=b,this.selection=new yi.a,this.executingTasks=[],this.tableStatus=new Pi.a,this.cacheTiers=[],this.monAllowPoolDelete=!1,this.permissions=this.authStorageService.getPermissions(),this.tableActions=[{permission:"create",icon:P.a.add,routerLink:()=>this.urlBuilder.getCreate(),name:this.actionLabels.CREATE},{permission:"update",icon:P.a.edit,routerLink:()=>this.urlBuilder.getEdit(encodeURIComponent(this.selection.first().pool_name)),name:this.actionLabels.EDIT},{permission:"delete",icon:P.a.destroy,click:()=>this.deletePoolModal(),name:this.actionLabels.DELETE,disable:this.getDisableDesc.bind(this)}],this.permissions.configOpt.read&&this.configurationService.get("mon_allow_pool_delete").subscribe(e=>{if(d.a.has(e,"value")){const t=d.a.find(e.value,e=>"mon"===e.section)||{value:!1};this.monAllowPoolDelete="true"===t.value}})}ngOnInit(){const e=(e,t,i)=>d.a.get(t,e)>d.a.get(i,e)?1:-1;this.columns=[{prop:"pool_name",name:"Name",flexGrow:4,cellTransformation:Xi.a.executing},{prop:"data_protection",name:"Data Protection",cellTransformation:Xi.a.badge,customTemplateConfig:{class:"badge-background-gray"},flexGrow:1.3},{prop:"application_metadata",name:"Applications",cellTransformation:Xi.a.badge,customTemplateConfig:{class:"badge-background-primary"},flexGrow:1.5},{prop:"pg_status",name:"PG Status",flexGrow:1.2,cellClass:({row:e,column:t,value:i})=>this.getPgStatusCellClass(e,t,i)},{prop:"crush_rule",name:"Crush Ruleset",isHidden:!0,flexGrow:2},{name:"Usage",prop:"usage",cellTemplate:this.poolUsageTpl,flexGrow:1.2},{prop:"stats.rd_bytes.rates",name:"Read bytes",comparator:(t,i,a,o)=>e("stats.rd_bytes.latest",a,o),cellTransformation:Xi.a.sparkline,flexGrow:1.5},{prop:"stats.wr_bytes.rates",name:"Write bytes",comparator:(t,i,a,o)=>e("stats.wr_bytes.latest",a,o),cellTransformation:Xi.a.sparkline,flexGrow:1.5},{prop:"stats.rd.rate",name:"Read ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:Xi.a.perSecond},{prop:"stats.wr.rate",name:"Write ops",flexGrow:1,pipe:this.dimlessPipe,cellTransformation:Xi.a.perSecond}],this.taskListService.init(()=>this.ecpService.list().pipe(Object(Di.a)(e=>(this.ecProfileList=e,this.poolService.getList()))),void 0,e=>{this.pools=this.transformPoolsData(e),this.tableStatus=new Pi.a},()=>{this.table.reset(),this.tableStatus=new Pi.a(Si.a.ValueException)},e=>e.name.startsWith("pool/"),(e,t)=>t.metadata.pool_name===e.pool_name,{default:e=>new Ti(e.pool_name)})}updateSelection(e){this.selection=e}deletePoolModal(){const e=this.selection.first().pool_name;this.modalService.show(I.a,{itemDescription:"Pool",itemNames:[e],submitActionObservable:()=>this.taskWrapper.wrapTaskAroundCall({task:new _.a(`pool/${n.e.DELETE}`,{pool_name:e}),call:this.poolService.delete(e)})})}getPgStatusCellClass(e,t,i){return{"text-right":!0,[`pg-${this.pgCategoryService.getTypeByStates(i)}`]:!0}}getErasureCodeProfile(e){let t="";return d.a.forEach(this.ecProfileList,i=>{i.name===e&&(t=`EC: ${i.k}+${i.m}`)}),t}transformPoolsData(e){const t=["bytes_used","max_avail","avail_raw","percent_used","rd_bytes","wr_bytes","rd","wr"],i={latest:0,rate:0,rates:[]};return d.a.forEach(e,e=>{e.pg_status=this.transformPgStatus(e.pg_status);const a={};d.a.forEach(t,t=>{a[t]=e.stats&&e.stats[t]?e.stats[t]:i}),e.stats=a,e.usage=a.percent_used.latest,e.cdExecuting||e.pg_num+e.pg_placement_num===e.pg_num_target+e.pg_placement_num_target||(e.cdExecuting="Updating"),["rd_bytes","wr_bytes"].forEach(t=>{e.stats[t].rates=e.stats[t].rates.map(e=>e[1])}),e.cdIsBinary=!0,"erasure"===e.type&&(e.data_protection=this.getErasureCodeProfile(e.erasure_code_profile)),"replicated"===e.type&&(e.data_protection=`replica: \xd7${e.size}`)}),e}transformPgStatus(e){const t=[];return d.a.forEach(e,(e,i)=>{t.push(`${e} ${i}`)}),t.join(", ")}getSelectionTiers(){if(void 0!==this.expandedRow){const e=this.expandedRow.tiers;this.cacheTiers=this.pools.filter(t=>e.includes(t.pool))}}getDisableDesc(){var e;return!(null===(e=this.selection)||void 0===e?void 0:e.hasSelection)||!this.monAllowPoolDelete&&"Pool deletion is disabled by the mon_allow_pool_delete configuration setting."}setExpandedRow(e){super.setExpandedRow(e),this.getSelectionTiers()}}return e.\u0275fac=function(t){return new(t||e)(p.Rb(D.a),p.Rb(E.a),p.Rb(v),p.Rb($.a),p.Rb(Ni.a),p.Rb(w.a),p.Rb(Wi.a),p.Rb(_i.a),p.Rb($i.a),p.Rb(Ii.a),p.Rb(n.b))},e.\u0275cmp=p.Lb({type:e,selectors:[["cd-pool-list"]],viewQuery:function(e,t){if(1&e&&(p.Wc(Ci.a,1),p.Wc(ji,3),p.Wc(Ji,1)),2&e){let e;p.Ec(e=p.mc())&&(t.table=e.first),p.Ec(e=p.mc())&&(t.poolUsageTpl=e.first),p.Ec(e=p.mc())&&(t.poolConfigurationSourceTpl=e.first)}},features:[p.Cb([Ni.a,{provide:$i.a,useValue:new $i.a("pool")}]),p.Ab],decls:10,vars:2,consts:function(){let e,t;return e="Pools List",t="Overall Performance",[["ngbNav","",1,"nav-tabs"],["nav","ngbNav"],["ngbNavItem",""],["ngbNavLink",""],e,["ngbNavContent",""],["ngbNavItem","",4,"ngIf"],[3,"ngbNavOutlet"],["poolUsageTpl",""],["id","pool-list","selectionType","single",3,"data","columns","hasDetails","status","autoReload","fetchData","setExpandedRow","updateSelection"],["table",""],["id","pool-list-actions",1,"table-actions",3,"permission","selection","tableActions"],["cdTableDetail","","id","pool-list-details",3,"selection","permissions","cacheTiers"],t,["uid","z99hzWtmk","grafanaStyle","two",3,"grafanaPath"],["decimals","2",3,"total","used",4,"ngIf"],["decimals","2",3,"total","used"]]},template:function(e,t){if(1&e&&(p.Xb(0,"ul",0,1),p.Xb(2,"li",2),p.Xb(3,"a",3),p.bc(4,4),p.Wb(),p.Pc(5,Ki,4,11,"ng-template",5),p.Wb(),p.Pc(6,Hi,4,0,"li",6),p.Wb(),p.Sb(7,"div",7),p.Pc(8,Zi,1,1,"ng-template",null,8,p.Qc)),2&e){const e=p.Fc(1);p.Db(6),p.uc("ngIf",t.permissions.grafana.read),p.Db(1),p.uc("ngbNavOutlet",e)}},directives:[s.p,s.r,s.s,s.q,a.r,s.u,Ci.a,wi.a,Ui,ki.a,Gi.a],styles:["cd-pool-list .pg-clean{color:#0b0}  cd-pool-list .pg-working{color:#2b99a8}  cd-pool-list .pg-warning{color:#ffc200}  cd-pool-list .pg-unknown{color:#ef5c55}"]}),e})(),ta=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.Pb({type:e}),e.\u0275inj=p.Ob({imports:[[b.a,a.c,s.t,l.a,c.i,o.x,s.F,r.BlockModule]]}),e})();const ia=[{path:"",component:ea},{path:n.e.CREATE,component:vi,data:{breadcrumbs:n.a.CREATE}},{path:`${n.e.EDIT}/:name`,component:vi,data:{breadcrumbs:n.a.EDIT}}];let aa=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=p.Pb({type:e}),e.\u0275inj=p.Ob({imports:[[ta,c.i.forChild(ia)]]}),e})()}}]);